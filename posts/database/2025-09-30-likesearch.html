<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>실행 계획으로 확인하는 Like 검색 최적화 | 앤디 블로그</title><meta name="description" content="Like 검색 쿼리를 개선하기 위한 인덱싱 작업입니다.">
    <link rel="preload" href="/assets/style-Bh5D_Jjo.css" as="style"><link rel="stylesheet" href="/assets/style-Bh5D_Jjo.css">
    <link rel="modulepreload" href="/assets/app-5h2Ow504.js"><link rel="modulepreload" href="/assets/2025-09-30-likesearch.html-BmRTWEdG.js">
    <link rel="prefetch" href="/assets/index.html-B5ZtCt1D.js" as="script"><link rel="prefetch" href="/assets/index.html-BozSgUNt.js" as="script"><link rel="prefetch" href="/assets/index.html-CwUB1nVt.js" as="script"><link rel="prefetch" href="/assets/index.html-CiT1ems2.js" as="script"><link rel="prefetch" href="/assets/index.html-GkkpM6Q0.js" as="script"><link rel="prefetch" href="/assets/2023-11-18-system.html-CYYu1ivQ.js" as="script"><link rel="prefetch" href="/assets/2025-02-08-whatiswork.html-BdkWyFcg.js" as="script"><link rel="prefetch" href="/assets/2025-02-11-kafka.html-BCQBiBbO.js" as="script"><link rel="prefetch" href="/assets/2025-02-16-object.html-CSOa6SVm.js" as="script"><link rel="prefetch" href="/assets/2025-03-03-skilloflove.html-MGXKqkwg.js" as="script"><link rel="prefetch" href="/assets/2025-03-08-terraform.html-BD0GIJrJ.js" as="script"><link rel="prefetch" href="/assets/2025-03-09-software.html-Bzp0fjjl.js" as="script"><link rel="prefetch" href="/assets/2025-03-23-chosun.html-DUV4fvk0.js" as="script"><link rel="prefetch" href="/assets/2025-08-31-unittest.html-BSoUrtUn.js" as="script"><link rel="prefetch" href="/assets/2025-02-07-ze.html-BQrp1pjq.js" as="script"><link rel="prefetch" href="/assets/2025-02-10-firstlog.html-B98Z3mVw.js" as="script"><link rel="prefetch" href="/assets/2025-02-14-log.html-BZ-WBVJz.js" as="script"><link rel="prefetch" href="/assets/2025-02-23-anna.html-Bvgru-e4.js" as="script"><link rel="prefetch" href="/assets/2025-03-02-bystander.html-CowAFG4C.js" as="script"><link rel="prefetch" href="/assets/2025-04-08-k8s.html-Zt5Bzalx.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-log.html-Cat-8rtL.js" as="script"><link rel="prefetch" href="/assets/2025-08-18-coworker.html-DosZGB8F.js" as="script"><link rel="prefetch" href="/assets/2025-02-25-aws.html-CGOkNsFD.js" as="script"><link rel="prefetch" href="/assets/2025-03-13-aws.html-D4EhThjA.js" as="script"><link rel="prefetch" href="/assets/2025-03-20-aws.html-DnpAMP8x.js" as="script"><link rel="prefetch" href="/assets/index.html-fAHltIcW.js" as="script"><link rel="prefetch" href="/assets/2025-08-26-culture1.html-Pum0kX4z.js" as="script"><link rel="prefetch" href="/assets/2025-08-27-culturetest.html-CbqX3aVG.js" as="script"><link rel="prefetch" href="/assets/index.html-BC-fm9nW.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-leteraljoin.html-DSal3f5I.js" as="script"><link rel="prefetch" href="/assets/index.html-QT4j1MSn.js" as="script"><link rel="prefetch" href="/assets/2023-10-20-cpucredit.html-D23b5pq6.js" as="script"><link rel="prefetch" href="/assets/2023-12-15-awslambda.html-DYpoK4a8.js" as="script"><link rel="prefetch" href="/assets/2024-05-23-goodlog.html-My5UYfxY.js" as="script"><link rel="prefetch" href="/assets/2024-10-28-sg.html-iH7chz_u.js" as="script"><link rel="prefetch" href="/assets/2025-01-24-eksdnsresolve.html-fVkpoqbe.js" as="script"><link rel="prefetch" href="/assets/2025-03-15-filesystem.html-fvvQuWFQ.js" as="script"><link rel="prefetch" href="/assets/2025-05-04-awsregion.html-DW08DtfS.js" as="script"><link rel="prefetch" href="/assets/2025-09-03-kuberesource.html-BFLV0I-c.js" as="script"><link rel="prefetch" href="/assets/2025-09-05-podeviction.html-B4xs5Kj9.js" as="script"><link rel="prefetch" href="/assets/2025-09-15-autoscaling.html-DogzqRbF.js" as="script"><link rel="prefetch" href="/assets/2025-09-22-rollingupdate.html-PqEninET.js" as="script"><link rel="prefetch" href="/assets/2025-09-29-loadtest.html-DGd1PCWg.js" as="script"><link rel="prefetch" href="/assets/index.html-BxxSI0cc.js" as="script"><link rel="prefetch" href="/assets/2025-09-17-hashmap.html-6QJ-sZjs.js" as="script"><link rel="prefetch" href="/assets/2025-09-23-referencevalue.html-BdgG83FO.js" as="script"><link rel="prefetch" href="/assets/2025-10-04-stringimmutable.html-BjHBKo3u.js" as="script"><link rel="prefetch" href="/assets/2025-10-05-immutableclass.html-CnzD2nwj.js" as="script"><link rel="prefetch" href="/assets/2025-10-05-singleton.html-C1oPhQhD.js" as="script"><link rel="prefetch" href="/assets/index.html-CPMDqlga.js" as="script"><link rel="prefetch" href="/assets/2025-01-18-kafkadocker.html-DiHRnWcu.js" as="script"><link rel="prefetch" href="/assets/index.html-u3Z6k2t4.js" as="script"><link rel="prefetch" href="/assets/2023-04-12-validation.html-CgTnf0iT.js" as="script"><link rel="prefetch" href="/assets/2023-04-18-rtr.html-DI5axcTB.js" as="script"><link rel="prefetch" href="/assets/2023-04-25-mdc.html-xYsUWGOt.js" as="script"><link rel="prefetch" href="/assets/2023-05-10-SpringRestDocs1.html-DxPW3xv8.js" as="script"><link rel="prefetch" href="/assets/2023-05-13-SpringRestDocs2.html-DAqvFl_P.js" as="script"><link rel="prefetch" href="/assets/2023-05-14-SpringRestDocs3.html-C8Q0Rm4N.js" as="script"><link rel="prefetch" href="/assets/2025-02-13-security.html-CqGMPTNL.js" as="script"><link rel="prefetch" href="/assets/2025-06-25-alarm.html-nPh3eOGi.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-Z8HvK_N4.js" as="script"><link rel="prefetch" href="/assets/2025-08-05-test1.html-DLg0d0n-.js" as="script"><link rel="prefetch" href="/assets/2025-08-20-test2.html-dPVj1TFO.js" as="script"><link rel="prefetch" href="/assets/2025-08-28-jsonproperty.html-CXyTRFng.js" as="script"><link rel="prefetch" href="/assets/2025-09-08-sonarqube.html-BSgoxjfV.js" as="script"><link rel="prefetch" href="/assets/index.html-C50MeUWW.js" as="script"><link rel="prefetch" href="/assets/2025-01-01-list.html-2nrxNVtW.js" as="script"><link rel="prefetch" href="/assets/2025-06-27-iot.html-wr0w_1LX.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-Bj4KVrhl.js" as="script"><link rel="prefetch" href="/assets/2025-08-13-mqtt.html-BgXUc8DA.js" as="script"><link rel="prefetch" href="/assets/2025-08-29-oidc.html-BEEgq5oI.js" as="script"><link rel="prefetch" href="/assets/2025-09-04-smtp.html-BjiEWAeY.js" as="script"><link rel="prefetch" href="/assets/2025-09-16-cscd.html-CxtIkv1o.js" as="script"><link rel="prefetch" href="/assets/2025-09-18-flame.html-D574BHfQ.js" as="script"><link rel="prefetch" href="/assets/2025-10-01-keycloak.html-Dtf7t57U.js" as="script"><link rel="prefetch" href="/assets/index.html-DksWpo1u.js" as="script"><link rel="prefetch" href="/assets/404.html-Di6GsXY3.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-C8Y_oDP9.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">앤디 블로그</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/culture/" aria-label="개발 문화"><!--[--><!--[--><!--]--><!--]-->개발 문화<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/tech/" aria-label="기술"><!--[--><!--[--><!--]--><!--]-->기술<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="자바"><!--[--><!--[--><!--]--><!--]-->자바<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/infra/" aria-label="인프라"><!--[--><!--[--><!--]--><!--]-->인프라<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resume/" aria-label="이력서"><!--[--><!--[--><!--]--><!--]-->이력서<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/culture/" aria-label="개발 문화"><!--[--><!--[--><!--]--><!--]-->개발 문화<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/tech/" aria-label="기술"><!--[--><!--[--><!--]--><!--]-->기술<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="자바"><!--[--><!--[--><!--]--><!--]-->자바<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/infra/" aria-label="인프라"><!--[--><!--[--><!--]--><!--]-->인프라<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resume/" aria-label="이력서"><!--[--><!--[--><!--]--><!--]-->이력서<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">실행 계획으로 확인하는 Like 검색 최적화 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-문제-상황" aria-label="1. 문제 상황"><!--[--><!--[--><!--]--><!--]-->1. 문제 상황<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-2-b-tree-인덱스의-한계" aria-label="1.2 B-tree 인덱스의 한계"><!--[--><!--[--><!--]--><!--]-->1.2 B-tree 인덱스의 한계<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-문제-해결" aria-label="2. 문제 해결"><!--[--><!--[--><!--]--><!--]-->2. 문제 해결<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_2-1-trigram-tri-gram-개념" aria-label="2.1 Trigram(tri-gram) 개념"><!--[--><!--[--><!--]--><!--]-->2.1 Trigram(tri-gram) 개념<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-2-postgresql에서의-pg-trgm-확장" aria-label="2.2 PostgreSQL에서의 pg_trgm 확장"><!--[--><!--[--><!--]--><!--]-->2.2 PostgreSQL에서의 pg_trgm 확장<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-3-동작-원리" aria-label="2.3 동작 원리"><!--[--><!--[--><!--]--><!--]-->2.3 동작 원리<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-4-특징" aria-label="2.4 특징"><!--[--><!--[--><!--]--><!--]-->2.4 특징<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_3-해결-후-실행-계획-확인" aria-label="3. 해결 후 실행 계획 확인"><!--[--><!--[--><!--]--><!--]-->3. 해결 후 실행 계획 확인<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-추가-개념-gin-인덱스" aria-label="4. 추가 개념: gin 인덱스"><!--[--><!--[--><!--]--><!--]-->4. 추가 개념: gin 인덱스<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_4-1-기본-개념" aria-label="4.1 기본 개념"><!--[--><!--[--><!--]--><!--]-->4.1 기본 개념<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-2-인덱스-구조" aria-label="4.2 인덱스 구조"><!--[--><!--[--><!--]--><!--]-->4.2 인덱스 구조<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-3-쓰기-insert-update-시-동작" aria-label="4.3 쓰기(INSERT/UPDATE) 시 동작"><!--[--><!--[--><!--]--><!--]-->4.3 쓰기(INSERT/UPDATE) 시 동작<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-4-읽기-select-시-동작" aria-label="4.4 읽기(SELECT) 시 동작"><!--[--><!--[--><!--]--><!--]-->4.4 읽기(SELECT) 시 동작<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_5-예시-like-good" aria-label="5. 예시: LIKE &#39;%good%&#39;"><!--[--><!--[--><!--]--><!--]-->5. 예시: LIKE &#39;%good%&#39;<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_6-장단점" aria-label="6. 장단점"><!--[--><!--[--><!--]--><!--]-->6. 장단점<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><header class="page-header" data-v-84f05ea1><h1 class="title" data-v-84f05ea1>실행 계획으로 확인하는 Like 검색 최적화</h1><div class="meta" data-v-84f05ea1><time data-v-84f05ea1>2025년 9월 30일</time></div></header><nav class="table-of-contents"><ul><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_1-문제-상황" class="router-link-active router-link-exact-active">1. 문제 상황</a><ul><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_1-2-b-tree-인덱스의-한계" class="router-link-active router-link-exact-active">1.2 B-tree 인덱스의 한계</a></li></ul></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_2-문제-해결" class="router-link-active router-link-exact-active">2. 문제 해결</a><ul><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_2-1-trigram-tri-gram-개념" class="router-link-active router-link-exact-active">2.1 Trigram(tri-gram) 개념</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_2-2-postgresql에서의-pg-trgm-확장" class="router-link-active router-link-exact-active">2.2 PostgreSQL에서의 pg_trgm 확장</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_2-3-동작-원리" class="router-link-active router-link-exact-active">2.3 동작 원리</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_2-4-특징" class="router-link-active router-link-exact-active">2.4 특징</a></li></ul></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_3-해결-후-실행-계획-확인" class="router-link-active router-link-exact-active">3. 해결 후 실행 계획 확인</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_4-추가-개념-gin-인덱스" class="router-link-active router-link-exact-active">4. 추가 개념: gin 인덱스</a><ul><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_4-1-기본-개념" class="router-link-active router-link-exact-active">4.1 기본 개념</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_4-2-인덱스-구조" class="router-link-active router-link-exact-active">4.2 인덱스 구조</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_4-3-쓰기-insert-update-시-동작" class="router-link-active router-link-exact-active">4.3 쓰기(INSERT/UPDATE) 시 동작</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_4-4-읽기-select-시-동작" class="router-link-active router-link-exact-active">4.4 읽기(SELECT) 시 동작</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_5-예시-like-good" class="router-link-active router-link-exact-active">5. 예시: LIKE &#39;%good%&#39;</a></li><li><a aria-current="page" href="/posts/database/2025-09-30-likesearch.html#_6-장단점" class="router-link-active router-link-exact-active">6. 장단점</a></li></ul></li></ul></nav><blockquote><p>예제 데이터는 <a href="https://www.kaggle.com/datasets/bharadwaj6/kindle-reviews" target="_blank" rel="noopener noreferrer">해당 사이트</a>의 리뷰 데이터를 활용했다. (총 982618개)</p></blockquote><h1 id="_1-문제-상황" tabindex="-1"><a class="header-anchor" href="#_1-문제-상황"><span>1. 문제 상황</span></a></h1><p>review 테이블에서 review_text 로 검색하는 쿼리는 다음과 같다. 이때 대소문자 구분없이 검색하기 위해 <code>lower()</code> 를 사용한다.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> review</span>
<span class="line"><span class="token keyword">where</span> lower<span class="token punctuation">(</span>reviewtext<span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">&#39;%good%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>아무런 인덱스나 설정이 없다면 full scan 을 하게 된다. 이 쿼리의 실행계획은 아래와 같다.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Gather  (cost=1000.00..83362.62 rows=7863 width=585)</span>
<span class="line">  Workers Planned: 2</span>
<span class="line">  -&gt;  Parallel Seq Scan on review  (cost=0.00..81576.32 rows=3276 width=585)</span>
<span class="line">        Filter: (lower(reviewtext) ~~ &#39;%good%&#39;::text)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Gather</code> 노드는 여러 워커 프로세스에서 처리한 결과를 모아주는 역할을 한다.</li><li><code>Workers Planned: 2</code> → 워커 2개를 띄워서 데이터를 병렬로 스캔한다.</li><li><code>Parallel Seq Scan on review</code> : 인덱스를 쓰지 않고 테이블 전체를 순차적으로 읽다. Parallel Seq Scan 은 테이블을 여러 프로세스가 나눠서 읽으므로 순차 스캔보다 빠를 수 있다.</li><li><code>Filter: (lower(reviewtext) ~~ &#39;%good%&#39;::text)</code> : ~~는 LIKE의 내부 연산자다.</li></ul><h2 id="_1-2-b-tree-인덱스의-한계" tabindex="-1"><a class="header-anchor" href="#_1-2-b-tree-인덱스의-한계"><span>1.2 B-tree 인덱스의 한계</span></a></h2><p><u>여기서 review_text 에 인덱스를 걸어보고 실행계획을 비교해보자.</u></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">index</span> idx_reviewtext <span class="token keyword">on</span> review <span class="token punctuation">(</span>reviewtext<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>이 때 <code>[54000] ERROR: index row requires 10728 bytes, maximum size is 8191 Where: parallel worker</code> 라는 에러가 나온다. 이는 PostgreSQL의 B-tree 인덱스 한계때문이다.</p><ul><li>Postgres의 일반 B-tree 인덱스는 한 row의 인덱스 엔트리가 <strong>최대 8191바이트(약 8KB)</strong> 를 초과할 수 없다.</li><li><code>reviewtext</code> 컬럼이 긴 텍스트를 포함하고 있을 경우, 그대로 인덱스를 만들면 특정 row에서 이 제한을 초과하여 인덱스 생성에 실패하게 된다.</li></ul><p>만약 B-tree 인덱스가 만들어진다고 해도 <strong><code>%good%</code> 이나<code> %good</code> 검색에는 활용될 수 없다.</strong> B-tree 인덱스는 <strong>정렬된 순서</strong>를 유지하기 때문에 <code>WHERE reviewtext LIKE &#39;good%&#39;</code>처럼 <strong>접두어(prefix)</strong> 가 고정된 검색에는 잘 동작한다. 그 이유는 <code>&#39;good&#39;</code>으로 시작하는 값들이 인덱스 상에서 <strong>연속된 구간(range)</strong> 을 이루기 때문이다. (인덱스 탐색 후 필요한 범위만 읽으면 된다.)</p><p>하지만 <code>%</code>가 앞에 붙어 있는 경우 <code>&#39;good&#39;</code>이 문자열 어디에 나올지 전혀 알 수 없다. 즉, <u>인덱스의 정렬 구조를 활용할 수 없어 모든 행을 확인해야 때문에 이 경우는 풀스캔을 피하기 어렵다.</u></p><h1 id="_2-문제-해결" tabindex="-1"><a class="header-anchor" href="#_2-문제-해결"><span>2. 문제 해결</span></a></h1><p>문제를 해결을 위해 <strong>Trigram 인덱스</strong>와 <strong>Full Text Search (FTS)</strong> 를 찾았고 Trigram 인덱스를 사용하기로 결정했다. FTS 는 단어 단위 검색에 최적화되어있기 때문이다.</p><blockquote><p><strong>Trigram 인덱스 (<code>pg_trgm</code>)</strong></p><ul><li>문자열을 3글자 단위로 쪼개서 GIN 인덱스에 저장. <code>%good%</code> 같은 부분 문자열 검색에도 인덱스를 활용할 수 있음.</li></ul><p><strong>Full Text Search (FTS)</strong></p><ul><li>단어 단위 검색에 최적화. <code>%good%</code> 같은 단순 부분검색이 아니라 <code>&quot;good&quot;</code>이라 는 단어를 찾을 때 훨씬 효율적임</li></ul></blockquote><h2 id="_2-1-trigram-tri-gram-개념" tabindex="-1"><a class="header-anchor" href="#_2-1-trigram-tri-gram-개념"><span>2.1 Trigram(tri-gram) 개념</span></a></h2><p><strong>Trigram</strong> 은 문자열을 <strong>3글자 단위</strong>로 쪼갠 조각을 의미한다. 예를 들어 <code>&quot;good&quot;</code>이라는 문자열이 있다면,</p><ul><li>시작과 끝을 구분하기 위해 보통 padding(<code>␣</code>)을 붙여서 분리한다.</li><li><code>&quot; g&quot;</code>, <code>&quot; go&quot;</code>, <code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code>, <code>&quot;od &quot;</code> 이런 식으로 3글자 단위 조각(trigram) 생성한다.</li><li>이렇게 쪼개진 trigrams 집합을 인덱스에 저장한다.</li></ul><h2 id="_2-2-postgresql에서의-pg-trgm-확장" tabindex="-1"><a class="header-anchor" href="#_2-2-postgresql에서의-pg-trgm-확장"><span>2.2 PostgreSQL에서의 <code>pg_trgm</code> 확장</span></a></h2><p>PostgreSQL은 <code>pg_trgm</code> 확장을 통해 trigram 기반 검색을 지원한다. 아래와 같이 설치하고 인덱스를 생성한다.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> EXTENSION <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> pg_trgm<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_review_reviewtext_trgm <span class="token keyword">ON</span> review <span class="token keyword">USING</span> gin <span class="token punctuation">(</span>lower<span class="token punctuation">(</span>reviewtext<span class="token punctuation">)</span> gin_trgm_ops<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>GIN</strong>(Generalized Inverted Index)</p><ul><li>각 row의 값들을 <strong>토큰/요소 단위로 분해해서 역색인(inverted index) 구조</strong>로 저장</li><li>&quot;이 값이 들어 있냐?&quot;를 빠르게 판별</li><li>예: 배열에 특정 값이 포함되어 있는지, 문자열에 특정 trigram이 있는지</li></ul></blockquote><h2 id="_2-3-동작-원리" tabindex="-1"><a class="header-anchor" href="#_2-3-동작-원리"><span>2.3 동작 원리</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> review <span class="token keyword">WHERE</span> lower<span class="token punctuation">(</span>reviewtext<span class="token punctuation">)</span> <span class="token operator">LIKE</span> <span class="token string">&#39;%good%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><p>실행 과정</p><ol><li>검색어 <code>&quot;good&quot;</code>을 trigram 집합으로 쪼갠다. (<code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code>)</li><li>인덱스에서 <code>&quot;goo&quot;</code> 또는 <code>&quot;ood&quot;</code>를 포함하는 row 후보군을 빠르게 찾는다.</li><li>후보군만 실제 문자열 비교로 최종 결과를 도출한다.</li></ol></li></ul><p>즉, <strong>후보군을 빠르게 줄여주고 나머지 검증만 하기 때문에 성능이 크게 향상</strong>된다.</p><h2 id="_2-4-특징" tabindex="-1"><a class="header-anchor" href="#_2-4-특징"><span>2.4 특징</span></a></h2><p><strong>장점</strong></p><ul><li><p><strong>부분 문자열 검색 지원</strong></p><ul><li><code>%good%</code>, <code>%oo%</code>, <code>o%</code> 같은 검색에도 인덱스 활용 가능.</li></ul></li><li><p><strong>유사도 검색 지원</strong> : 철자 오류나 오타 검색에 유용</p><ul><li><code>similarity()</code> 함수와 결합하면 <code>&quot;god&quot;</code> ≈ <code>&quot;good&quot;</code> 같은 fuzzy matching 이 가능하다.</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">SELECT * FROM review </span>
<span class="line">WHERE similarity(reviewtext, &#39;good&#39;) &gt; 0.3;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>단점</strong></p><ul><li>문자열을 trigram으로 쪼개서 저장하므로 인덱스가 커서 저장공간이 많이 든다.</li><li>문자열 변경 시 trigram 인덱스도 갱신해야 하므로 write 부하가 늘어나고 Insert/Update 성능이 저하된다.</li><li><u>정확히 prefix search (<code>good%</code>)만 필요하다면 B-tree 인덱스가 더 효율적이다.</u></li></ul><h1 id="_3-해결-후-실행-계획-확인" tabindex="-1"><a class="header-anchor" href="#_3-해결-후-실행-계획-확인"><span>3. 해결 후 실행 계획 확인</span></a></h1><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_review_reviewtext_trgm <span class="token keyword">ON</span> review <span class="token keyword">USING</span> gin <span class="token punctuation">(</span>lower<span class="token punctuation">(</span>reviewtext<span class="token punctuation">)</span> gin_trgm_ops<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>해당 인덱스를 만들고 실행계획을 확인한다.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">explain</span></span>
<span class="line"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> review</span>
<span class="line"><span class="token keyword">where</span> lower<span class="token punctuation">(</span>reviewtext<span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">&#39;%good%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>아래와 같이 나온다.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Bitmap Heap Scan on review  (cost=87.80..23038.73 rows=7861 width=585)</span>
<span class="line">  Recheck Cond: (lower(reviewtext) ~~ &#39;%good%&#39;::text)</span>
<span class="line">  -&gt;  Bitmap Index Scan on idx_review_reviewtext_trgm  (cost=0.00..85.83 rows=7861 width=0)</span>
<span class="line">        Index Cond: (lower(reviewtext) ~~ &#39;%good%&#39;::text)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><code>Bitmap Index Scan on idx_review_reviewtext_trgm</code></li></ol><ul><li><code>lower(reviewtext) LIKE &#39;%good%&#39;</code> 로 탐색</li><li><code>idx_review_reviewtext_trgm</code> 인덱스로 조건을 만족할 가능성이 있는 row들의 위치(rowid = TID)를 비트맵 형태로 생성한다.</li><li>인덱스만 탐색하기 때문에 비용이 매우 저렴함</li></ul><ol start="2"><li><code>Bitmap Heap Scan on review</code><ul><li>인덱스에서 가져온 비트맵(rowid 집합)을 기반으로 실제 테이블(Heap)에서 데이터를 읽는다.</li><li><code>Recheck Cond</code><ul><li>GIN 인덱스는 후보군을 빠르게 좁히지만 <strong>정확히 매칭되는지는 다시 확인이 필요</strong>하다.</li><li>즉, 후보 row를 실제 데이터에서 다시 확인해서 <code>&#39;good&#39;</code>이 정말 들어있는지 체크한다. 이 과정을 <strong>recheck</strong>라고 부른다.</li></ul></li></ul></li></ol><p>실행 계획은 다음과 같은 흐름이다.</p><ol><li><code>pg_trgm</code> 인덱스를 활용해 &quot;good&quot;이 포함될 가능성이 있는 row 후보를 모음 (<code>Bitmap Index Scan</code>)</li><li>후보 row들을 테이블에서 읽고 실제 조건 재검증 (<code>Bitmap Heap Scan</code>)</li><li>최종적으로 매칭되는 row 반환</li></ol><h1 id="_4-추가-개념-gin-인덱스" tabindex="-1"><a class="header-anchor" href="#_4-추가-개념-gin-인덱스"><span>4. 추가 개념: gin 인덱스</span></a></h1><h2 id="_4-1-기본-개념" tabindex="-1"><a class="header-anchor" href="#_4-1-기본-개념"><span>4.1 기본 개념</span></a></h2><ul><li><strong>GIN (Generalized Inverted Index)</strong> 는 말 그대로 <strong>역색인(inverted index)</strong> 이다.</li><li>RDBMS에서 보통 인덱스(B-tree)는 <code>값 → row 위치</code> 구조인데,</li><li><strong>GIN은 <code>토큰(요소) → row 목록</code> 구조</strong>로 저장한다.</li></ul><p>즉,</p><ul><li>B-tree: <code>&quot;홍길동&quot;</code> → rowid=123</li><li>GIN: <code>&quot;홍&quot;</code>, <code>&quot;길&quot;</code>, <code>&quot;동&quot;</code> 각각 → [rowid=123, rowid=456, …]</li></ul><h2 id="_4-2-인덱스-구조" tabindex="-1"><a class="header-anchor" href="#_4-2-인덱스-구조"><span>4.2 인덱스 구조</span></a></h2><p>GIN 인덱스는 크게 두 계층으로 나뉜다.</p><ul><li><strong>Entry Tree</strong><ul><li>인덱스의 &quot;키&quot;(= 토큰, trigram, 단어 등)를 관리하는 B-tree 구조</li><li>예: <code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code>, <code>&quot;app&quot;</code> 같은 trigram 키</li></ul></li><li><strong>Posting List / Posting Tree</strong><ul><li>해당 키를 가진 row들의 목록(row TID)을 저장</li><li>row가 적으면 메모리에 바로 올릴 수 있는 <strong>posting list</strong> 형태</li><li>row가 많아지면 별도의 B-tree인 <strong>posting tree</strong>로 분리 저장</li></ul></li></ul><h2 id="_4-3-쓰기-insert-update-시-동작" tabindex="-1"><a class="header-anchor" href="#_4-3-쓰기-insert-update-시-동작"><span>4.3 쓰기(INSERT/UPDATE) 시 동작</span></a></h2><ol><li>새 row 삽입하면 해당 컬럼 값이 토큰화된다. <ul><li>예: <code>&quot;good&quot;</code> → <code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code></li></ul></li><li>각각의 토큰을 <strong>Entry Tree</strong>에서 찾아 위치를 확인한다.</li><li>해당 키에 rowid를 <strong>posting list</strong>에 추가한다.</li><li>posting list가 너무 커지면 → posting tree로 분리한다.</li></ol><p>이 때문에 GIN은 <strong>쓰기 비용이 크다</strong> (토큰 분해 + 여러 곳에 rowid 삽입)</p><h2 id="_4-4-읽기-select-시-동작" tabindex="-1"><a class="header-anchor" href="#_4-4-읽기-select-시-동작"><span>4.4 읽기(SELECT) 시 동작</span></a></h2><ol><li>쿼리 조건을 토큰으로 분해 <ul><li>예: <code>LIKE &#39;%good%&#39;</code> → <code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code></li><li>FTS <code>&quot;app &amp; name&quot;</code> → <code>&quot;app&quot;</code>, <code>&quot;name&quot;</code></li></ul></li><li>Entry Tree에서 해당 토큰을 찾아 posting list/tree 를 얻는다.</li><li>교집합/합집합 연산으로 후보 rowid 집합을 생성 <ul><li><code>&quot;goo&quot;</code>와 <code>&quot;ood&quot;</code> 둘 다 있어야 함 → 교집합</li></ul></li><li>후보 rowid에 대해 실제 데이터 확인( recheck ) → 최종 결과 반환</li></ol><p>이 구조 덕분에 <strong>부분 검색/포함 검색</strong>이 빠르다.</p><h2 id="_5-예시-like-good" tabindex="-1"><a class="header-anchor" href="#_5-예시-like-good"><span>5. 예시: LIKE &#39;%good%&#39;</span></a></h2><ol><li><code>&quot;good&quot;</code> → <code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code></li><li>Entry Tree에서 <code>&quot;goo&quot;</code>, <code>&quot;ood&quot;</code> 키를 찾음</li><li>각 키가 가진 posting list에서 rowid 모음 <ul><li><code>&quot;goo&quot;</code> → [1, 5, 8]</li><li><code>&quot;ood&quot;</code> → [5, 8, 12]</li></ul></li><li>교집합 → [5, 8]</li><li>row 5, 8에서 실제 문자열 비교 후 최종 결과 확정</li></ol><h2 id="_6-장단점" tabindex="-1"><a class="header-anchor" href="#_6-장단점"><span>6. 장단점</span></a></h2><ul><li><p><strong>장점</strong></p><ul><li>부분 문자열 검색, 배열 포함, JSONB 키 검색, Full Text Search에 강력</li><li>후보군을 줄이는 데 최적화 → 큰 테이블에서 효과 극대화</li></ul></li><li><p><strong>단점</strong></p><ul><li>인덱스 크기가 큼 (토큰 단위로 쪼개 저장)</li><li>쓰기 성능이 느림 (row 추가 시 많은 토큰 업데이트 필요)</li><li>항상 recheck 과정이 필요 → 100% 인덱스만으로 끝나지 않음</li></ul></li><li><p>읽기는 빠르지만, 쓰기는 무겁고 인덱스 크기도 크다</p></li><li><p>따라서 보통 <strong>읽기 위주 workload</strong> (검색, 로그 분석, 텍스트 검색 등)에 적합하다.</p></li></ul><nav class="vp-page-nav" aria-label="page navigation" data-v-63cabaa2><!----><!----></nav></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-5h2Ow504.js" defer></script>
  </body>
</html>
