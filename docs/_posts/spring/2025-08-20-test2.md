---
title: "í…ŒìŠ¤íŠ¸ê°€ ì—…ë¬´ë‹¤ - 2 (CICD: kover, diff-cover)"
date: 2025-08-19
tags:
  - kover
  - diff-cover
description: "íšŒì‚¬ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ì„œ ì–»ì€ ì¸ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤."
---

# 1. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ íˆ´ì„ ë„ì…í•œ ì´ìœ 

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëª¨ë‘ ì‘ì„±í•œ ì´í›„, í…ŒìŠ¤íŠ¸ ë¬¸í™”ë¥¼ ì •ì°©í•˜ê¸° ìœ„í•´ (ë¹„ë¡ ê±°ì˜ í˜¼ì ì½”ë“œë¥¼ ì§œê³  ìˆì§€ë§Œ) í…ŒìŠ¤íŠ¸ ê²°ê³¼ì™€ ì»¤ë²„ë¦¬ì§€ë¥¼ PR ë©”ì‹œì§€ë¡œ ìƒì„±í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤. ì²˜ìŒì—ëŠ” í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œë¥¼ ì„¤ì •í•˜ë ¤ê³  í–ˆìœ¼ë‚˜ í˜„ì¬ ìƒí™©ì—ì„œ ìˆ«ì ìì²´ëŠ” ë¬´ì˜ë¯¸í•˜ë‹¤ê³  ìƒê°í•˜ì—¬ ëª©í‘œëŠ” ë”°ë¡œ ì—†ì´ ì¸¡ì •ë§Œ í•˜ë„ë¡ í–ˆë‹¤.

## ëª©í‘œ

- CI ì™€ ì»¤ë²„ë¦¬ì§€ í™•ì¸ì„ í†µí•©
- ì‹ ê·œ/ë³€ê²½ ë¼ì¸ ì»¤ë²„ë¦¬ì§€(diff coverage)ë¥¼ ìˆ˜ì¹˜ë¡œ ë³´ì—¬ì¤€ë‹¤.
- ì „ì²´ ì»¤ë²„ë¦¬ì§€ë„ í•¨ê»˜ ë³´ë˜, ë¨¸ì§€ ê¸°ì¤€ì€ ë³€ê²½ë¶„ì— ë‘”ë‹¤. (í˜„ì¬ëŠ” ëª©í‘œ ì„¤ì • x)

# 2. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ íˆ´

### Kover

  **ë­ í•˜ëŠ” íˆ´ì¸ê°€**

  - Kotlin/JVM í”„ë¡œì íŠ¸ì˜ ì»¤ë²„ë¦¬ì§€ë¥¼ ë½‘ëŠ” **Gradle í”ŒëŸ¬ê·¸ì¸**ì´ë‹¤.
  - ë‚´ë¶€ì ìœ¼ë¡œ IntelliJ ì»¤ë²„ë¦¬ì§€ ì—”ì§„ì„ ì“°ê³ , **JaCoCo XML í¬ë§·**ì„ ë±‰ëŠ”ë‹¤. ê·¸ë˜ì„œ ë‹¤ë¥¸ ë„êµ¬(ì˜ˆ: diff-cover)ì™€ ë°”ë¡œ ë¬¼ë¦°ë‹¤.
  - Kotlinì˜ ì¸ë¼ì¸ í•¨ìˆ˜, `data class` ìƒì„± ì½”ë“œ, ë””í´íŠ¸ ì¸ì ë“±ì—ì„œ **ë¼ì¸ ë§¤ì¹­ì´ JaCoCoë³´ë‹¤ ìì—°ìŠ¤ëŸ¬ìš´ ê²½ìš°ê°€ ë§ë‹¤.**

  **ì™œ Koverë¥¼ ì¼ë‚˜ (ì¥ì )**

  - **Kotlin ì¹œí™”ì **ì´ë‹¤. ì½”í‹€ë¦° íŠ¹ìœ ì˜ ìƒì„± ì½”ë“œ ë•Œë¬¸ì— ì»¤ë²„ë¦¬ì§€ ë¼ì¸ì´ ì–´ìƒ‰í•˜ê²Œ ì¡íˆëŠ” ë¬¸ì œë¥¼ ì¤„ì˜€ë‹¤.
  - **ì„¤ì •ì´ ê°„ë‹¨**í•˜ë‹¤. í”ŒëŸ¬ê·¸ì¸ë§Œ ì¶”ê°€í•˜ë©´ `koverXmlReport`, `koverHtmlReport` ê°™ì€ íƒœìŠ¤í¬ê°€ ë°”ë¡œ ìƒê¸´ë‹¤.
  - **í•„í„°(Exclude)**ê°€ ìœ ì—°í•˜ë‹¤. íŒ¨í‚¤ì§€/í´ë˜ìŠ¤/íŒŒì¼/ì–´ë…¸í…Œì´ì…˜ ê¸°ì¤€ìœ¼ë¡œ ì œì™¸í•  ìˆ˜ ìˆì–´ ì¡ìŒ(ì˜ˆ: `config`, DTO, ìƒì„±ì½”ë“œ)ì„ ì •ë¦¬í•˜ê¸° ì¢‹ë‹¤.

  **ì„¤ì¹˜/ì‚¬ìš©**
   `build.gradle.kts`

  ```
  plugins {
      kotlin("jvm") version "1.9.24"
      id("org.jetbrains.kotlinx.kover") version "0.8.3"
  }
  
  tasks.test { useJUnitPlatform() }
  
  /**
   * ë¦¬í¬íŠ¸ ìƒì„± (ê¸°ë³¸ ê²½ë¡œ ì˜ˆ)
   *  - XML:  build/reports/kover/report.xml
   *  - HTML: build/reports/kover/html/index.html
   */
  ```

  **ìì£¼ ì“°ëŠ” íƒœìŠ¤í¬**

  ```
  # í…ŒìŠ¤íŠ¸ + XML
  ./gradlew test koverXmlReport
  
  # HTML ë¦¬í¬íŠ¸ê¹Œì§€
  ./gradlew test koverHtmlReport
  
  # (ë£¨íŠ¸ì—ì„œ) ë©€í‹°ëª¨ë“ˆ ì§‘ê³„ XML/HTML
  ./gradlew :koverXmlReport :koverHtmlReport
  ```

  **í•„í„°ë§(ë…¸ì´ì¦ˆ ì¤„ì´ê¸°)**

  ```
  kover {
      filters {
          classes {
              excludes += listOf(
                  "com.example.config.*",
                  "com.example.generated.*",
                  "*.ApplicationKt"
              )
          }
          // í•„ìš”í•˜ë©´ íŒ¨í‚¤ì§€/íŒŒì¼/ì–´ë…¸í…Œì´ì…˜ ë‹¨ìœ„ë„ ê°€ëŠ¥
      }
  }
  ```

  > íŒ: â€œì»¤ë²„ë¦¬ì§€ 0% ì°íˆëŠ” íŒŒì¼â€ì€ ëŒ€ê°œ **ìƒì„± ì½”ë“œ**ê±°ë‚˜ **í…ŒìŠ¤íŠ¸ì—ì„œ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ë¡œ**ë‹¤. í•„í„°ì—ì„œ ê³¼ê°íˆ ì œì™¸í•˜ê±°ë‚˜, í…ŒìŠ¤íŠ¸ë¡œ ì‹¤ì œ ì‚¬ìš© ê²½ë¡œë¥¼ íƒœìš°ë©´ ëœë‹¤.


### diff-cover

- **JaCoCo XML ë¦¬í¬íŠ¸ + `git diff`**ë¥¼ ë¹„êµí•´ì„œ **â€œì´ë²ˆ ë³€ê²½ ë¼ì¸ë“¤ì˜ ì»¤ë²„ë¦¬ì§€â€**(diff coverage)ë¥¼ ê³„ì‚°í•œë‹¤.
  - ì¶œë ¥ í˜•ì‹ì€ **í…ìŠ¤íŠ¸/ANSI/Markdown/HTML/JSON/XML**ì„ ì§€ì›í•œë‹¤. PR ì½”ë©˜íŠ¸/ì²´í¬/ì•„í‹°íŒ©íŠ¸ ë“± ìš©ë„ì— ë§ì¶° ë½‘ì„ ìˆ˜ ìˆë‹¤.

  **ì™œ diff-coverë¥¼ ì¼ë‚˜ (ì¥ì )**

  - **ë³€ê²½ë¶„ ì¤‘ì‹¬ì˜ í’ˆì§ˆ ê´€ë¦¬**ê°€ ëœë‹¤. ì „ì²´ ì»¤ë²„ë¦¬ì§€ ìˆ˜ì¹˜ê°€ ë†’ì•„ë„ **ìƒˆë¡œ ë°”ê¾¼ ì½”ë“œê°€ ë¹„ì–´ ìˆìœ¼ë©´** ë°”ë¡œ ì¡ì•„ë‚¸ë‹¤.
  - **ë¨¸ì§€ ê¸°ì¤€ìœ¼ë¡œ ì“°ê¸° ì¢‹ë‹¤.** `--fail-under 80`ì²˜ëŸ¼ ì„ê³„ì¹˜ë¥¼ ê±¸ì–´ **ì²´í¬ ì‹¤íŒ¨ â†’ ë¨¸ì§€ ì°¨ë‹¨** íë¦„ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- **ë„ì…ì´ ë¹ ë¥´ë‹¤.** Koverê°€ ë‚´ëŠ” XMLë§Œ ìˆìœ¼ë©´ ë°”ë¡œ ì ìš©ëœë‹¤. ë¹Œë“œ íŒŒì´í”„ë¼ì¸ì— ê±°ì˜ ì˜í–¥ ì—†ë‹¤.
  - **ì¶œë ¥ í¬ë§·ì´ í’ë¶€**í•´ì„œ PR ì½”ë©˜íŠ¸/HTML ë¦¬í¬íŠ¸/ë¨¸ì‹  íŒŒì‹±(JSON)ê¹Œì§€ í•œ ë²ˆì— í•´ê²°í•œë‹¤.


**Kover + diff-cover ì‹œë„ˆì§€**

  - KoverëŠ” **ì •í™•í•œ Kotlin ë¼ì¸ ë§¤í•‘ + JaCoCo XML**ì„ ì œê³µí•˜ê³ , diff-coverëŠ” ê·¸ XMLë¡œ **ë³€ê²½ë¶„ ì»¤ë²„ë¦¬ì§€**ë¥¼ ê³„ì‚°í•œë‹¤.
  - ë‘˜ì„ ì—®ìœ¼ë©´ **â€œì „ì²´ ì»¤ë²„ë¦¬ì§€(í—¬ìŠ¤ ì²´í¬)â€ + â€œë³€ê²½ë¶„ ì»¤ë²„ë¦¬ì§€(ë¨¸ì§€ ê¸°ì¤€)â€**ë¥¼ ë™ì‹œì— ë§Œì¡±í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì•„ì£¼ ê°„ë‹¨íˆ ë§Œë“ ë‹¤.
- íŠ¹íˆ ì½”í‹€ë¦° í”„ë¡œì íŠ¸ì—ì„œ **ë¶ˆí•„ìš”í•œ ë¼ì¸(ìƒì„± ì½”ë“œ)**ì„ Kover í•„í„°ë¡œ ë¹¼ê³ , ë‚˜ë¨¸ì§€ë¥¼ diff-coverë¡œ ì§‘ìš”í•˜ê²Œ ë³¸ë‹¤. ë¦¬ë·° ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì¤„ê³ , ì‹¤íŒ¨ë„ **â€œì •ë§ í•„ìš”í•œ ì‹¤íŒ¨â€**ë§Œ ë‚œë‹¤.

# 3. ë„ì… ë°©ë²•

### Gradleì— Kover ì¶”ê°€

```
plugins {
    ...
    
    id("org.jetbrains.kotlinx.kover") version "0.9.1" // Kover í”ŒëŸ¬ê·¸ì¸
}

tasks.test {
    useJUnitPlatform()
}


```

í•´ë‹¹ plugin ì„ ì¶”ê°€í•˜ë©´ `./gradlew koverXmlReport` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. `build/reports/kover/` ìœ„ì¹˜ì— report.xml ì„ ìƒì„±í•´ì¤€ë‹¤. í•´ë‹¹ ë¦¬í¬íŠ¸ëŠ” ì „ì²´ í…ŒìŠ¤íŠ¸ì— ëŒ€í•œ ì»¤ë²„ë¦¬ì§€ì´ë‹¤.

## GitHub Actionsì™€ í†µí•©

ëª©í‘œëŠ” **PRì— ìŠ¤í‹°í‚¤ ì½”ë©˜íŠ¸ 1ê°œ**ë¡œ `ì „ì²´ ì»¤ë²„ë¦¬ì§€ + ë³€ê²½ë¶„ ì»¤ë²„ë¦¬ì§€`ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì´ë‹¤.

```yml
.github/workflows/diff-coverage.yml
name: Diff Coverage (Kover + diff-cover)

on:
  pull_request:
    branches: [ main ]

permissions:
  contents: read
  pull-requests: write

jobs:
  diff-coverage:
    runs-on: ubuntu-latest
    env:
      THRESHOLD: "80"
      COVER_XML: build/reports/kover/report.xml

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # JDK + Gradle ìºì‹œ
      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "21"
          cache: gradle

      # í”„ë¡œì íŠ¸ .gradle ìºì‹œ(ì¦ë¶„ ë¹Œë“œ ê°€ì†)
      - name: Cache project .gradle
        uses: actions/cache@v3
        with:
          path: .gradle
          key: gradle-project-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: gradle-project-${{ runner.os }}-

      - name: Build & Test (Kover XML)
        run: ./gradlew --no-daemon test koverXmlReport

      - name: Verify coverage XML exists
        run: |
          test -f "${{ env.COVER_XML }}" || {
            echo "Coverage XML not found at ${{ env.COVER_XML }}"; exit 1;
          }

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install diff-cover
        run: pip install diff-cover

      # ë¡œê·¸ì— ìš”ì•½ + ì„ê³„ì¹˜ ì²´í¬(ë¯¸ë‹¬ ì‹œ ì‹¤íŒ¨)
      - name: Diff coverage (fail-under + log)
        run: |
          diff-cover "${{ env.COVER_XML }}" \
            --compare-branch origin/${{ github.base_ref || 'main' }} \
            --src-roots src/main/kotlin src/test/kotlin \
            --fail-under "${{ env.THRESHOLD }}" \
            --format ansi:-

      # HTML/Markdown ë¦¬í¬íŠ¸ ìƒì„±
      - name: Diff coverage (reports)
        run: |
          diff-cover "${{ env.COVER_XML }}" \
            --compare-branch origin/${{ github.base_ref || 'main' }} \
            --src-roots src/main/kotlin src/test/kotlin \
            --format html:diff-cover.html,markdown:diff-cover.md

      # ì „ì²´/ë³€ê²½ íŒŒì¼ ì»¤ë²„ë¦¬ì§€ ìˆ˜ì¹˜ë¥¼ ì¶”ì¶œ(ì½”ë©˜íŠ¸ëŠ” ë§Œë“¤ì§€ ì•ŠìŒ)
      - name: JaCoCo coverage summary (no comment)
        id: jacoco
        uses: madrapps/jacoco-report@v1.7.2
        with:
          paths: ${{ github.workspace }}/${{ env.COVER_XML }}
          token: ${{ secrets.GITHUB_TOKEN }}
          min-coverage-overall: 0
          min-coverage-changed-files: 0
          comment-type: "none"

      # diff-cover.md -> í…Œì´ë¸” ë³€í™˜ + summary ë§ë¶™ì—¬ ìµœì¢… ì½”ë©˜íŠ¸ ìƒì„±
      - name: Merge coverage reports (build pr-comment.md)
        run: |
          echo "# ğŸ“Š Coverage Report" > pr-comment.md
          echo "" >> pr-comment.md
          echo "- Overall coverage: **${{ steps.jacoco.outputs['coverage-overall'] }}**" >> pr-comment.md
          echo "- Changed files coverage: **${{ steps.jacoco.outputs['coverage-changed-files'] }}**" >> pr-comment.md
          echo "" >> pr-comment.md
          echo "### ğŸ” Diff Coverage" >> pr-comment.md
          echo "" >> pr-comment.md
          echo "|Files|Diff Coverage (%)|Missing lines|" >> pr-comment.md
          echo "|-----|-----------------|--------------|" >> pr-comment.md

          # 3ë²ˆì§¸ ì¤„ë¶€í„° ì½ê³ , ë¹ˆ ì¤„ì€ ë¬´ì‹œ, '## Summary' ë§Œë‚˜ë©´ ì¢…ë£Œ
          tail -n +3 diff-cover.md | while read -r line; do
            [[ -z "$line" ]] && continue
            [[ "$line" == "## Summary"* ]] && break

            file=$(echo "$line"    | sed -E 's/^- ([^(]+) .*/\1/')
            percent=$(echo "$line" | sed -E 's/.*\(([0-9.]+%)\).*/\1/')
            missing=$(echo "$line" | grep -o 'Missing lines.*' | sed -E 's/Missing lines //')
            [[ -z "$missing" ]] && missing=" "

            # ê²½ë¡œ ì• 6ê°œ ì»´í¬ë„ŒíŠ¸ ì œê±° (src/main/kotlin/... ê¸°ì¤€)
            short_file=$(echo "$file" | cut -d'/' -f7-)

            echo "|$short_file|$percent|$missing|" >> pr-comment.md
          done

          echo "" >> pr-comment.md
          # ì›ë³¸ì˜ Summary ë¸”ë¡ ì¶”ê°€
          awk '/^## Summary/{flag=1} flag' diff-cover.md >> pr-comment.md

      # ìŠ¤í‹°í‚¤ ì½”ë©˜íŠ¸ë¡œ PRì— 1ê°œë§Œ ìœ ì§€
      - name: Post PR comment (sticky)
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          path: pr-comment.md

      # HTML ë¦¬í¬íŠ¸ëŠ” ì•„í‹°íŒ©íŠ¸ë¡œ ì—…ë¡œë“œ(ë‹¤ìš´ë¡œë“œí•´ì„œ ì—´ì–´ë³´ê¸°)
      - name: Upload HTML report
        uses: actions/upload-artifact@v4
        with:
          name: diff-cover-report
          path: diff-cover.html
          if-no-files-found: error
          retention-days: 14
```

## ê²°ê³¼ë¬¼

1. Test Results : í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œë‹¤. ì‹¤íŒ¨í•œë‹¤ë©´ git actions ì˜ summary ì— ì‹¤íŒ¨ ë¡œê·¸ê°€ ì¶”ê°€ëœë‹¤.
2. Test Coverage Report : ì»¤ë°‹ëœ ë‚´ìš©ì˜ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë³´ê³ ì„œ

![screencapture-github-hobeen-kim-kovertest-pull-6-2025-08-25-15_19_17 (1)](../../.vuepress/public/images/2025-08-20-test2/screencapture-github-hobeen-kim-kovertest-pull-6-2025-08-25-15_19_17 (1).png)
