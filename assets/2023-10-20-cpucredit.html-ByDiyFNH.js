import{_ as p,c as d,a as t,b as l,d as u,f as i,r as s,o as m,e as a}from"./app-xNdwLuf6.js";const g="/images/2023-10-20-cpucredit/image-20250907235642538.png",U="/images/2023-10-20-cpucredit/image-20250907235705656.png",c="/images/2023-10-20-cpucredit/image-20250908000326198.png",h={},C={class:"table-of-contents"};function P(f,e){const r=s("Header"),n=s("router-link"),o=s("Footer");return m(),d("div",null,[t(r),l("nav",C,[l("ul",null,[l("li",null,[t(n,{to:"#t-인스턴스와-크레딧"},{default:i(()=>e[0]||(e[0]=[a("T 인스턴스와 크레딧")])),_:1}),l("ul",null,[l("li",null,[t(n,{to:"#t-타입-인스턴스의-특징"},{default:i(()=>e[1]||(e[1]=[a("T 타입 인스턴스의 특징")])),_:1})]),l("li",null,[t(n,{to:"#baseline"},{default:i(()=>e[2]||(e[2]=[a("Baseline")])),_:1})]),l("li",null,[t(n,{to:"#크레딧의-사용과-회복"},{default:i(()=>e[3]||(e[3]=[a("크레딧의 사용과 회복")])),_:1})]),l("li",null,[t(n,{to:"#크레딧이-다-사용된다면"},{default:i(()=>e[4]||(e[4]=[a("크레딧이 다 사용된다면?")])),_:1})])])]),l("li",null,[t(n,{to:"#프로젝트의-기준-사용률은"},{default:i(()=>e[5]||(e[5]=[a("프로젝트의 기준 사용률은?")])),_:1}),l("ul",null,[l("li",null,[t(n,{to:"#기준-사용률-계산"},{default:i(()=>e[6]||(e[6]=[a("기준 사용률 계산")])),_:1})]),l("li",null,[t(n,{to:"#다른-방법-사용해보기"},{default:i(()=>e[7]||(e[7]=[a("다른 방법 사용해보기")])),_:1}),l("ul",null,[l("li",null,[t(n,{to:"#무제한-모드-unlimited-mode"},{default:i(()=>e[8]||(e[8]=[a("무제한 모드(Unlimited Mode)")])),_:1})]),l("li",null,[t(n,{to:"#다른-최적의-t-타입-사용"},{default:i(()=>e[9]||(e[9]=[a("다른 최적의 t 타입 사용")])),_:1})]),l("li",null,[t(n,{to:"#다른-인스턴스-타입-사용"},{default:i(()=>e[10]||(e[10]=[a("다른 인스턴스 타입 사용")])),_:1})])])])])]),l("li",null,[t(n,{to:"#결론"},{default:i(()=>e[11]||(e[11]=[a("결론")])),_:1})])])]),e[12]||(e[12]=u('<h1 id="t-인스턴스와-크레딧" tabindex="-1"><a class="header-anchor" href="#t-인스턴스와-크레딧"><span>T 인스턴스와 크레딧</span></a></h1><p>AWS 에서 인스턴스 유형은 범용, 컴퓨팅, 메모리, 스토리지 등등 그 목적에 맞춰 세분화되어있다. 그중에서 T 계열은 가변적인 CPU 작업 부하에 적하다. 그 이유는 &quot;크레딧&quot; 으로 CPU 를 사용하기 때문이다.</p><h2 id="t-타입-인스턴스의-특징" tabindex="-1"><a class="header-anchor" href="#t-타입-인스턴스의-특징"><span>T 타입 인스턴스의 특징</span></a></h2><p>T 타입 인스턴스는 Burstable performance instance 로, CPU 를 사용하려면 <strong>CPU 크레딧</strong>이 필요하다. CPU 크레딧 하나로 vCPU 가 1분동안 100% 를 사용할 수 있다. 반대로 CPU 를 덜 사용하면 다시 크레딧이 충전된다.</p><p>만약 크레딧이 부족하다면 CPU 를 더 이상 쓸 수 없기 때문에 CPU 사용량에 제한을 받게 된다. 그러한 경우에서 많은 CPU 가 필요한 작업을 한다면 애플리케이션이 동작하지 않거나 서버가 다운되는 등의 상황이 발생한다.</p><h2 id="baseline" tabindex="-1"><a class="header-anchor" href="#baseline"><span>Baseline</span></a></h2><p>CPU 를 얼마나 사용해도 되고, 기준이 얼마인지는 각 타입마다의 <strong>Baseline</strong> 에 따라 다르다. Baseline 은 T 유형에 정해진 사용량 기준이다. 아래는 T 타입의 Baseline 이다.</p><p><img src="'+g+'" alt="image-20250907235642538"></p><p>여기서 vCPU 당 기준 사용률이 Baseline 이다. 프리티어에서 자주 사용되는 <code>t2.micro</code> 는 10% 다.</p><p><img src="'+U+'" alt="image-20250907235705656"></p><p>위 그림과 같이 CPU 사용량이 <strong>Baseline 보다 낮다면 크레딧이 증가</strong>하고, CPU 사용량이 <strong>높다면 크레딧이 소모</strong>된다.</p><p>따라서 T 타입을 사용할 때는 평소에는 Baseline 밑으로 CPU 사용량을 유지하다가, 필요할 때 모아둔 크레딧으로 사용량을 증가시키는 것이 이상적인 사용방법이다.</p><h2 id="크레딧의-사용과-회복" tabindex="-1"><a class="header-anchor" href="#크레딧의-사용과-회복"><span>크레딧의 사용과 회복</span></a></h2><p>대부분의 블로그 글에서 사용과 회복을 분리하고 있는데, 사용과 회복은 사실 동시에 이루어진다. RPG 게임을 예로 들어서, 캐릭터의 HP 는 최대 100 이고 초당 10 씩 회복된다고 해보자. 여기서 초당 5 의 데미지를 입으면 캐릭터는 마치 초당 5 씩 회복하는 것처럼 보인다. 하지만 실질적으로는 회복과 데미지가 동시에 적용되고 있다. 이걸 염두에 두고 설명해보자.</p><p>먼저 <strong>사용</strong>부터 보면, 크레딧은 1개 당 vCPU 1개를 100% 수준으로 1분 동안 사용할 수 있게 해준다. 50% 수준이면 2분 동안 사용할 수 있다. 만약 크레딧이 10개 있다면 50% 수준으로 20분을 사용할 수 있는 것이다. 하지만 크레딧이 10개가 있다고 해서 50% 수준으로 20분만 사용하고 끝이 아니다. 그 20분 동안 회복되는 크레딧이 있을테니까 말이다.</p><p>T 타입의 크기마다 회복되는 CPU 크레딧이 다르다. t2.micro 기준으로 시간 당 6개가 회복되고 총 144개가 최대치이다. 아래 공식을 따른다.</p><blockquote><p>시간 당 회복 크레딧 = vCPU 개수 x Baseline x 60minute</p><p>최대 보유 크레딧 = 시간 당 회복 크레딧 x 24</p></blockquote><p>예를 들어서, t2.micro 가 크레딧 100개가 있고 <strong>20% CPU 수준</strong>으로 사용한다고 해보자. t2.micro 는 시간 당 6개의 크레딧을 회복한다. 그리고 시간 당 12개의 크레딧을 소모한다. 결론적으로 시간 당 6개의 크레딧이 추가로 필요해지는 것이다. 따라서 크레딧 100개가 있을 때 총 16시간 가량을 20% 수준으로 유지할 수 있다.</p><p>좀 더 CPU 사용량을 낮춰서 <strong>10% CPU 수준을 유지</strong>한다고 하면 회복되는 크레딧 개수와 소모되는 크레딧 개수가 같아진다. 따라서 t2.micro 는 10% 수준에서는 계속 사용할 수 있다.</p><p>반대로 <strong>CPU 수준이 5%</strong> 라면 어떨까? 시간 당 회복되는 크레딧 개수는 6개로 동일한데, 소모되는 크레딧 개수는 3개이다. 따라서 <u>시간 당 3개의 크레딧이 적립되게 된다.</u></p><h2 id="크레딧이-다-사용된다면" tabindex="-1"><a class="header-anchor" href="#크레딧이-다-사용된다면"><span>크레딧이 다 사용된다면?</span></a></h2><p>위에서 간략하게 크레딧이 다 소모되었을 때 CPU 사용에 제한을 받는다고 했는데, T 타입은 크게 2가지 모드가 있습니다. 바로 <strong>일반모드(Standard Mode) 와 무제한 모드(Unlimited Mode)</strong> 다.</p><p><strong>일반모드</strong> 에서는 크레딧을 다 소모했을 때 Baseline 위로는 CPU 사용이 불가능하다. 즉, t2.micro 기준으로 10% 의 CPU 만 사용할 수 있다.</p><p>반면 <strong>무제한 모드</strong> 에서는 크레딧을 다 소모해도 제든지 원하는 기간 동안 높은 CPU 사용률을 유지할 수 있다. 대신 해당 CPU 사용량에 대해 시간당 CPU 인스턴스 요금이 적용된다.</p><h1 id="프로젝트의-기준-사용률은" tabindex="-1"><a class="header-anchor" href="#프로젝트의-기준-사용률은"><span>프로젝트의 기준 사용률은?</span></a></h1><p>그렇다면 이 크레딧 개념을 t2.micro 를 사용하는 프로젝트에 적용시켜보자. 조건은 아래와 같다.</p><ul><li>트래픽이 10시부터 저녁 10시까지 12시간 동안 지속 발생</li><li>12시간 이후에는 baseline 을 넘길만큼의 트래픽이 없음</li><li>12시간 동안 트래픽을 감당하기 위해선 평균 90% 수준의 CPU 사용량이 필요</li><li>트래픽이 없을 때는 2% 의 CPU 사용량</li></ul><h2 id="기준-사용률-계산" tabindex="-1"><a class="header-anchor" href="#기준-사용률-계산"><span>기준 사용률 계산</span></a></h2><p>트래픽이 거의 없는 12시간 동안 57.6개의 크레딧이 회복된다. ((6크레딧 - 2% * 60분) * 12) 그러면 57.6개의 크레딧을 720분 (12시간) 동안 나눠써야 하는데, 분당 0.08개의 추가 크레딧 소모가 가능하다. 그러면 <u>12시간 동안 평균 18% 의 CPU 사용량이 최대</u>이다. 90% 는 한참 미치지 못한다.</p><h2 id="다른-방법-사용해보기" tabindex="-1"><a class="header-anchor" href="#다른-방법-사용해보기"><span>다른 방법 사용해보기</span></a></h2><p>일단 t2.micro 인스턴스 1개로는 원하는 성능이 나오지 않기 때문에 다른 방법을 찾아봤다.</p><ol><li>무제한 모드 사용</li><li>다른 T 타입 인스턴스 사용</li><li>다른 인스턴스 타입 사용</li></ol><h3 id="무제한-모드-unlimited-mode" tabindex="-1"><a class="header-anchor" href="#무제한-모드-unlimited-mode"><span>무제한 모드(Unlimited Mode)</span></a></h3><p>t2.micro 를 무제한 모드로 바꿨다고 가정하고 추가되는 요금을 계산해보자</p><blockquote><p>시간 당 vCPU 가격 * vCPU 개수 * 초과된 CPU * 초과된 시간</p></blockquote><p>시간 당 vCPU 의 가격은 5센트다. 공식에 대입해보면 (5센트 * 1 * 72% * 24) 로 하루에 0.864 달러다. 30일이면 26달러 정도된다. 26달러면 t2.micro 서버를 3개 더 증설할 수 있는데, 이 가격으로 무제한 모드로 사용하는 건 적절치 못한 선택인 듯 하다.</p><h3 id="다른-최적의-t-타입-사용" tabindex="-1"><a class="header-anchor" href="#다른-최적의-t-타입-사용"><span>다른 최적의 t 타입 사용</span></a></h3><p>위 무제한 모드를 적용했을 때 가격은 t2.micro 인스턴스 가격 포함 한달에 총 34달러다. 그렇다면 T 타입 제품군 중 한달에 34달러 미만인 제품부터 찾아야 한다.</p><p>medium 정도까지가 30달러 정도인데 그중에서는 가장 싼 t4g.midium 으로 계산해보자. 이 인스턴스 타입은 ARM 기반의 AWS Graviton2 프로세서를 사용하는데 AWS 에서는 t3 에서 사용하는 프로세서보다 더 좋다고 한다. 어쨋든 한 달 가격은 <strong>24달러</strong>가 된다. 자원은 아래와 같다.</p><ul><li>vCPU 2개, 메모리 4GiB</li><li>Baseline 20%, 시간 당 획득 크레딧 24개</li></ul><p>그리고 CPU 가 2개이므로 단순 계산으로 50% 의 성능이 필요하다고 가정해보자. 이 부분은 실제로 돌려봐야 알지만, 컨텍스트 스위칭, 병렬 작업이 얼마나 있는지 등등에 따라 매우 달라진다. 어쨋든 50% 성능이 필요하다고 생각하고 계산했다.</p><p>트래픽이 거의 없는 12시간 동안 259.2개의 크레딧이 회복된다. ((24크레딧 - 2% * 60분 * 2vCPU) * 12) 그러면 259.2개의 크레딧을 720분동안 2개의 CPU 가 나눠써야 한다. CPU 당 0.18개/m 의 추가 크레딧 소모가 가능해진다. 그러면 <u>12시간 동안 평균 38% 의 CPU 사용량이 최대</u>가 된다. 그렇다면 12% 는 다시 버스트 모드로 사용해야 한다.</p><p>(5센트 * 2 * 0.12 * 24) 를 하면 0.288달러로, 한 달에 8.64달러가 된다. 그러면 총 가격은 <strong>32.64달러</strong>로 t2.micro 보다 2달러 가량 싸다. 하지만 메모리도 t2.micro 에 비해 4배나 되는 점을 생각하면 2달러보다는 더 큰 값어치이기는 하다.</p><h3 id="다른-인스턴스-타입-사용" tabindex="-1"><a class="header-anchor" href="#다른-인스턴스-타입-사용"><span>다른 인스턴스 타입 사용</span></a></h3><p>이렇게 지속적으로 CPU 를 소모하는 인스턴스는 T 타입을 사용하는 건 사실 맞지 않다. T 타입은 CPU 사용량을 크레딧으로 모아놨다가 한번에 터트려서 사용하는(Burst) 타입이다. 12시간 동안 높은 CPU 사용량이 필요하면 다른 인스턴스 타입을 찾는 게 맞다.</p><p>AWS 에서 제공하는 인스턴스 타입은 여러가지가 있는데, 그중에서도 <u>범용 인스턴스인 m6g</u> 로 검색해봤다.</p><p><img src="'+c+'" alt="image-20250908000326198"></p><p><strong>m6g.medium 의 월 가격은 34달러이다.</strong> 그것보다 한 단계 높여서 vCPU 를 2개 이상하려면 가격이 68달러로 올라간다. saving plan 이나 예약 인스턴스면 절반으로 싸지긴 하지만 그건 T 타입도 마찬가지라서 고려하진 않았다.</p><h1 id="결론" tabindex="-1"><a class="header-anchor" href="#결론"><span>결론</span></a></h1><p>뭘 하든 제가 원하는 성능을 가지려면 30달러는 지출해야 한다고 생각해야하고, 사실 CPU 성능도 더 필요하긴 해서 m6g.large 정도를 구매한다고 생각하면 한 달에 68달러는 지출해야 한다. 스케일 아웃 혹은 스케일 업이 필요하다는건데 그전에 CPU 를 최적화할 수 있는 방법이 없을까 고민해봐야겠다.</p>',50)),t(o)])}const b=p(h,[["render",P],["__file","2023-10-20-cpucredit.html.vue"]]),T=JSON.parse('{"path":"/posts/infra/2023-10-20-cpucredit.html","title":"T 인스턴스의 CPU 크레딧과 적정 CPU 사용량 계산","lang":"en-US","frontmatter":{"title":"T 인스턴스의 CPU 크레딧과 적정 CPU 사용량 계산","date":"2023-10-20T00:00:00.000Z","tags":["credit","t-instance"],"description":"프로젝트에 비용을 고려한 CPU 사용량에 대한 고민"},"headers":[{"level":1,"title":"T 인스턴스와 크레딧","slug":"t-인스턴스와-크레딧","link":"#t-인스턴스와-크레딧","children":[{"level":2,"title":"T 타입 인스턴스의 특징","slug":"t-타입-인스턴스의-특징","link":"#t-타입-인스턴스의-특징","children":[]},{"level":2,"title":"Baseline","slug":"baseline","link":"#baseline","children":[]},{"level":2,"title":"크레딧의 사용과 회복","slug":"크레딧의-사용과-회복","link":"#크레딧의-사용과-회복","children":[]},{"level":2,"title":"크레딧이 다 사용된다면?","slug":"크레딧이-다-사용된다면","link":"#크레딧이-다-사용된다면","children":[]}]},{"level":1,"title":"프로젝트의 기준 사용률은?","slug":"프로젝트의-기준-사용률은","link":"#프로젝트의-기준-사용률은","children":[{"level":2,"title":"기준 사용률 계산","slug":"기준-사용률-계산","link":"#기준-사용률-계산","children":[]},{"level":2,"title":"다른 방법 사용해보기","slug":"다른-방법-사용해보기","link":"#다른-방법-사용해보기","children":[{"level":3,"title":"무제한 모드(Unlimited Mode)","slug":"무제한-모드-unlimited-mode","link":"#무제한-모드-unlimited-mode","children":[]},{"level":3,"title":"다른 최적의 t 타입 사용","slug":"다른-최적의-t-타입-사용","link":"#다른-최적의-t-타입-사용","children":[]},{"level":3,"title":"다른 인스턴스 타입 사용","slug":"다른-인스턴스-타입-사용","link":"#다른-인스턴스-타입-사용","children":[]}]}]},{"level":1,"title":"결론","slug":"결론","link":"#결론","children":[]}],"git":{},"filePathRelative":"_posts/infra/2023-10-20-cpucredit.md"}');export{b as comp,T as data};
