<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>refresh 토큰과 RTR 기술 | 앤디 블로그</title><meta name="description" content="RTR 을 통해 리프레시 토큰 보안 강화">
    <link rel="preload" href="/assets/style-Dag_jc5t.css" as="style"><link rel="stylesheet" href="/assets/style-Dag_jc5t.css">
    <link rel="modulepreload" href="/assets/app-eWaF2Kn4.js"><link rel="modulepreload" href="/assets/2023-04-18-rtr.html-3LrwM9bI.js">
    <link rel="prefetch" href="/assets/index.html-DN7QQ3JF.js" as="script"><link rel="prefetch" href="/assets/index.html-kOx4oinL.js" as="script"><link rel="prefetch" href="/assets/index.html-DqUjzIjx.js" as="script"><link rel="prefetch" href="/assets/index.html-C1Hr_t2p.js" as="script"><link rel="prefetch" href="/assets/index.html-l3T0c-ke.js" as="script"><link rel="prefetch" href="/assets/2023-11-18-system.html-CW4odhDT.js" as="script"><link rel="prefetch" href="/assets/2025-02-08-whatiswork.html-BU8QhuR1.js" as="script"><link rel="prefetch" href="/assets/2025-02-11-kafka.html-BnIRnEqA.js" as="script"><link rel="prefetch" href="/assets/2025-02-16-object.html-DREDkQ-3.js" as="script"><link rel="prefetch" href="/assets/2025-03-03-skilloflove.html-BXmgb5kD.js" as="script"><link rel="prefetch" href="/assets/2025-03-08-terraform.html-C3YZ-tqy.js" as="script"><link rel="prefetch" href="/assets/2025-03-09-software.html-DCshtyLG.js" as="script"><link rel="prefetch" href="/assets/2025-03-23-chosun.html-BUyIv-wI.js" as="script"><link rel="prefetch" href="/assets/2025-08-31-unittest.html-1EgqGmpj.js" as="script"><link rel="prefetch" href="/assets/2025-02-07-ze.html-C_TMTKjL.js" as="script"><link rel="prefetch" href="/assets/2025-02-10-firstlog.html-BKB5IgfA.js" as="script"><link rel="prefetch" href="/assets/2025-02-14-log.html-DY8hArl-.js" as="script"><link rel="prefetch" href="/assets/2025-02-23-anna.html-BoRMEi00.js" as="script"><link rel="prefetch" href="/assets/2025-03-02-bystander.html-Jrgviob1.js" as="script"><link rel="prefetch" href="/assets/2025-04-08-k8s.html-wK_fqtVb.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-log.html-CSHpIt2k.js" as="script"><link rel="prefetch" href="/assets/2025-08-18-coworker.html-WYLmo9K0.js" as="script"><link rel="prefetch" href="/assets/2025-02-25-aws.html-BGt_C5_b.js" as="script"><link rel="prefetch" href="/assets/2025-03-13-aws.html-BtiMqnxe.js" as="script"><link rel="prefetch" href="/assets/2025-03-20-aws.html-ZTszdl6r.js" as="script"><link rel="prefetch" href="/assets/index.html-DAq2sK-_.js" as="script"><link rel="prefetch" href="/assets/2025-08-26-culture1.html-Diipfrbv.js" as="script"><link rel="prefetch" href="/assets/2025-08-27-culturetest.html-R6ngYqY9.js" as="script"><link rel="prefetch" href="/assets/index.html-DMvcK8Xg.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-leteraljoin.html-CO3vndxL.js" as="script"><link rel="prefetch" href="/assets/index.html-CzIhc5dX.js" as="script"><link rel="prefetch" href="/assets/2023-10-20-cpucredit.html-GEaxbJ4V.js" as="script"><link rel="prefetch" href="/assets/2023-12-15-awslambda.html-BODhv-Bj.js" as="script"><link rel="prefetch" href="/assets/2024-05-23-goodlog.html-BsBNVOXs.js" as="script"><link rel="prefetch" href="/assets/2024-10-28-sg.html-DMLIHIti.js" as="script"><link rel="prefetch" href="/assets/2025-01-24-eksdnsresolve.html-CBJ3Zq6_.js" as="script"><link rel="prefetch" href="/assets/2025-03-15-filesystem.html-bicL35sI.js" as="script"><link rel="prefetch" href="/assets/2025-05-04-awsregion.html-ftFwYRiJ.js" as="script"><link rel="prefetch" href="/assets/2025-09-03-kuberesource.html-B0loFJCL.js" as="script"><link rel="prefetch" href="/assets/2025-09-05-podeviction.html-Clj-yd30.js" as="script"><link rel="prefetch" href="/assets/2025-09-15-autoscaling.html-C8DELLvn.js" as="script"><link rel="prefetch" href="/assets/index.html-B6CWRAwo.js" as="script"><link rel="prefetch" href="/assets/2025-09-17-hashmap.html-GQARBQl5.js" as="script"><link rel="prefetch" href="/assets/2025-09-23-referencevalue.html-DDMaIf8h.js" as="script"><link rel="prefetch" href="/assets/index.html-2g4POThA.js" as="script"><link rel="prefetch" href="/assets/2025-01-18-kafkadocker.html-XY3m2E5t.js" as="script"><link rel="prefetch" href="/assets/index.html-Nmm5Zp1-.js" as="script"><link rel="prefetch" href="/assets/2023-04-12-validation.html-BNLKOIKS.js" as="script"><link rel="prefetch" href="/assets/2023-04-25-mdc.html-DzL_Gb7A.js" as="script"><link rel="prefetch" href="/assets/2023-05-10-SpringRestDocs1.html-CPvb_JZo.js" as="script"><link rel="prefetch" href="/assets/2023-05-13-SpringRestDocs2.html-k_86-Qzq.js" as="script"><link rel="prefetch" href="/assets/2023-05-14-SpringRestDocs3.html-DYeG_MRJ.js" as="script"><link rel="prefetch" href="/assets/2025-02-13-security.html-Bpo45n2A.js" as="script"><link rel="prefetch" href="/assets/2025-06-25-alarm.html-DtyQAG5l.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-BXDStyCe.js" as="script"><link rel="prefetch" href="/assets/2025-08-05-test1.html-DQ0oUOHy.js" as="script"><link rel="prefetch" href="/assets/2025-08-20-test2.html-BIc0gtT6.js" as="script"><link rel="prefetch" href="/assets/2025-08-28-jsonproperty.html-BtdkGSLI.js" as="script"><link rel="prefetch" href="/assets/2025-09-08-sonarqube.html-DAXwp1K7.js" as="script"><link rel="prefetch" href="/assets/index.html-Bk6YVZCJ.js" as="script"><link rel="prefetch" href="/assets/2025-01-01-list.html-BQQ9mbOP.js" as="script"><link rel="prefetch" href="/assets/2025-06-27-iot.html-CPLGqlkW.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-ChVT9zsA.js" as="script"><link rel="prefetch" href="/assets/2025-08-13-mqtt.html-DUt3iu_W.js" as="script"><link rel="prefetch" href="/assets/2025-08-29-oidc.html-DWDwUIuv.js" as="script"><link rel="prefetch" href="/assets/2025-09-04-smtp.html-DiLy56Cr.js" as="script"><link rel="prefetch" href="/assets/2025-09-16-cscd.html-DFEa1PPe.js" as="script"><link rel="prefetch" href="/assets/2025-09-18-flame.html-BQjGpp16.js" as="script"><link rel="prefetch" href="/assets/index.html-Dl_AIUMA.js" as="script"><link rel="prefetch" href="/assets/404.html-RXgKZoqb.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-GUg0hESD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">앤디 블로그</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/culture/" aria-label="개발 문화"><!--[--><!--[--><!--]--><!--]-->개발 문화<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/tech/" aria-label="기술"><!--[--><!--[--><!--]--><!--]-->기술<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="자바"><!--[--><!--[--><!--]--><!--]-->자바<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/infra/" aria-label="인프라"><!--[--><!--[--><!--]--><!--]-->인프라<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resume/" aria-label="이력서"><!--[--><!--[--><!--]--><!--]-->이력서<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/culture/" aria-label="개발 문화"><!--[--><!--[--><!--]--><!--]-->개발 문화<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/tech/" aria-label="기술"><!--[--><!--[--><!--]--><!--]-->기술<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="자바"><!--[--><!--[--><!--]--><!--]-->자바<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/infra/" aria-label="인프라"><!--[--><!--[--><!--]--><!--]-->인프라<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resume/" aria-label="이력서"><!--[--><!--[--><!--]--><!--]-->이력서<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">refresh 토큰과 RTR 기술 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#redis" aria-label="Redis"><!--[--><!--[--><!--]--><!--]-->Redis<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#인메모리" aria-label="인메모리"><!--[--><!--[--><!--]--><!--]-->인메모리<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#특징" aria-label="특징"><!--[--><!--[--><!--]--><!--]-->특징<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#redis-사용" aria-label="Redis 사용"><!--[--><!--[--><!--]--><!--]-->Redis 사용<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#cli-환경에서-저장" aria-label="CLI 환경에서 저장"><!--[--><!--[--><!--]--><!--]-->CLI 환경에서 저장<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#springboot-연동" aria-label="SpringBoot 연동"><!--[--><!--[--><!--]--><!--]-->SpringBoot 연동<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#refreshtoken-과-redis" aria-label="RefreshToken 과 Redis"><!--[--><!--[--><!--]--><!--]-->RefreshToken 과 Redis<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#rtr-refresh-token-rotation" aria-label="RTR (Refresh Token Rotation)"><!--[--><!--[--><!--]--><!--]-->RTR (Refresh Token Rotation)<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#refreshtoken-의-보안성-문제" aria-label="RefreshToken 의 보안성 문제"><!--[--><!--[--><!--]--><!--]-->RefreshToken 의 보안성 문제<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#rtr-동작-flow" aria-label="RTR 동작 flow"><!--[--><!--[--><!--]--><!--]-->RTR 동작 flow<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#attacker-에게-토큰을-탈취당할-경우" aria-label="Attacker 에게 토큰을 탈취당할 경우"><!--[--><!--[--><!--]--><!--]-->Attacker 에게 토큰을 탈취당할 경우<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#문제점" aria-label="문제점"><!--[--><!--[--><!--]--><!--]-->문제점<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#마치며" aria-label="마치며"><!--[--><!--[--><!--]--><!--]-->마치며<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#ref" aria-label="Ref."><!--[--><!--[--><!--]--><!--]-->Ref.<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><header class="page-header" data-v-84f05ea1><h1 class="title" data-v-84f05ea1>refresh 토큰과 RTR 기술</h1><div class="meta" data-v-84f05ea1><time data-v-84f05ea1>2023년 4월 18일</time></div></header><nav class="table-of-contents"><ul><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#redis" class="router-link-active router-link-exact-active">Redis</a><ul><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#인메모리" class="router-link-active router-link-exact-active">인메모리</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#특징" class="router-link-active router-link-exact-active">특징</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#redis-사용" class="router-link-active router-link-exact-active">Redis 사용</a><ul><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#cli-환경에서-저장" class="router-link-active router-link-exact-active">CLI 환경에서 저장</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#springboot-연동" class="router-link-active router-link-exact-active">SpringBoot 연동</a></li></ul></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#refreshtoken-과-redis" class="router-link-active router-link-exact-active">RefreshToken 과 Redis</a></li></ul></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#rtr-refresh-token-rotation" class="router-link-active router-link-exact-active">RTR (Refresh Token Rotation)</a><ul><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#refreshtoken-의-보안성-문제" class="router-link-active router-link-exact-active">RefreshToken 의 보안성 문제</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#rtr-동작-flow" class="router-link-active router-link-exact-active">RTR 동작 flow</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#attacker-에게-토큰을-탈취당할-경우" class="router-link-active router-link-exact-active">Attacker 에게 토큰을 탈취당할 경우</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#문제점" class="router-link-active router-link-exact-active">문제점</a></li></ul></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#마치며" class="router-link-active router-link-exact-active">마치며</a></li><li><a aria-current="page" href="/posts/spring/2023-04-18-rtr.html#ref" class="router-link-active router-link-exact-active">Ref.</a></li></ul></nav><h1 id="redis" tabindex="-1"><a class="header-anchor" href="#redis"><span>Redis</span></a></h1><blockquote><p>Redis is an open source (BSD licensed), in-memory <strong>data structure store</strong> used as a database, cache, message broker, and streaming engine.</p><p><a href="https://redis.io/docs/about/" target="_blank" rel="noopener noreferrer">Retis Introduction</a></p></blockquote><p>Redis 란 DB, cache, Message broker, streaming engine 을 제공하는 인메모리 데이터 저장소 입니다.</p><h2 id="인메모리" tabindex="-1"><a class="header-anchor" href="#인메모리"><span>인메모리</span></a></h2><p>인메모리는 RAM 에 데이터를 올려서 사용하는 방법입니다. 메모리에 올리는 이유는 SSD, HDD 같은 저장공간에서 데이터를 읽는 것보다 속도가 빠르기 때문입니다.</p><p>하지만 속도가 빠른 대신 당연하게도 용량이 작다는 단점이 있습니다. 그리고 <strong>Redis 는 key, value 형태</strong>의 NOSQL 로 저장되며 다양한 데이터 구조를 지원하기는 하지만 복잡한 데이터를 저장하기는 어렵습니다.</p><p>또한 인메모리이기 때문에 서버에 충돌이 발생하거나 다운되면 저장된 값이 사라지게 됩니다.</p><p>따라서 Redis 는 주로 보조적인 수단으로 사용되는 <strong>캐시 DB 서버</strong> 입니다. (Persistence x)</p><h2 id="특징" tabindex="-1"><a class="header-anchor" href="#특징"><span>특징</span></a></h2><ul><li>Redis는 List, Set, Sorted Set, Hash 등과 같은 Collection을 지원합니다. <ul><li>List : redis Strings의 묶음 Collection</li><li>Set : 중복되지 않는 값을 데이터로 갖는 Colelction</li><li>Sorted Set : 가중치(Score)를 갖고 가중치(Score)에 따른 정렬된 순서로 중복되지 않는 값을 데이터로 가지는 Colelction</li><li>Hash : Key 하나에 여러개의 Field와 Value로 구성된 즉, Key 내부에 또 다른 Key - value로 이루어진 Collection</li></ul></li><li>Dump 파일과 AOF(Append Of File) 방식으로 메모리 상의 데이터를 디스크에 저장할 수 있습니다.</li><li>Master/Slave Replication 기능을 통해 데이터의 분산, 복제 기능을 제공하며 Query Off Loading 기능을 통해 Master는 Read/Write를 수행하고 Slave는 Read만 수행할 수 있습니다.</li><li>파티셔닝(Partitioning)을 통해 동적인 스케일 아웃(Scale Out)인 수평 확장이 가능합니다.</li><li>Expiration 기능은 일정 시간이 지났을 때 메모리 상의 데이터를 자동 삭제할 수 있습니다.</li><li>Redis는 Single Thread -&gt; Atomic 보장</li></ul><h2 id="redis-사용" tabindex="-1"><a class="header-anchor" href="#redis-사용"><span>Redis 사용</span></a></h2><p>원도우용 Redis 는 여기서 다운로드 받습니다. <a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener noreferrer">윈도우용 Redis 다운로드</a></p><p>Redis 의 기본포트는 6379 입니다. 다운로드 이후 가동상태를 확인하려면 cmd 에서 다음과 같은 명령어를 입력해줍니다.</p><p><code>netstat -an | findstr 6379</code></p><p><img src="/images/2023-04-18-rtr/image-20230418221150364.png" alt="image-20230418221150364"></p><p>잘 가동중임을 알 수 있습니다. 재부팅을 하면 자동으로 서비스로 등록이 되어 있고 실행이 되어서 따로 시작을 안해줘도 됩니다. 따로 시작을 하려면 Redis 폴더에서 <code>redis-server.exe</code> 를 실행하면 됩니다.</p><h3 id="cli-환경에서-저장" tabindex="-1"><a class="header-anchor" href="#cli-환경에서-저장"><span>CLI 환경에서 저장</span></a></h3><p>redis 폴더에서 <code>redis-cli</code> 로 redis 를 실행시킵니다.</p><ul><li>key, value 저장 : <code>set name hobeen</code> 으로 저장합니다.</li><li>value 조회 : <code>get name</code> 으로 값을 조회합니다.</li><li>key, value 삭제 : <code>del name</code> 으로 값을 삭제합니다.</li></ul><p><img src="/images/2023-04-18-rtr/image-20230418222024231.png" alt="image-20230418222024231"></p><h3 id="springboot-연동" tabindex="-1"><a class="header-anchor" href="#springboot-연동"><span>SpringBoot 연동</span></a></h3><ol><li><strong>의존성</strong>을 추가합니다. (build.gradle)</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">	implementation &#39;org.springframework.boot:spring-boot-starter-data-redis-reactive&#39;</span>
<span class="line">	implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>application.yml</strong> 에 Redis 를 연결하기 위한 값을 넣습니다.</li></ol><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">redis</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">pool</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span></span>
<span class="line">    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1</span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>해당 값들의 의미는 다음과 같습니다.</p><table><thead><tr><th><strong>변수</strong></th><th><strong>기본값</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>spring.redis.database</td><td>0</td><td>커넥션 팩토리에 사용되는 데이터베이스 인덱스</td></tr><tr><td>spring.redis.host</td><td>localhost</td><td>레디스 서버 호스트</td></tr><tr><td>spring.redis.password</td><td>레디스 서버 로그인 패스워드</td><td></td></tr><tr><td>spring.redis.pool.max-active</td><td>8</td><td>pool에 할당될 수 있는 커넥션 최대수 (음수로 하면 무제한)</td></tr><tr><td>spring.redis.pool.max-idle</td><td>8</td><td>pool의 &quot;idle&quot; 커넥션 최대수 (음수로 하면 무제한)</td></tr><tr><td>spring.redis.pool.max-wait</td><td>-1</td><td>pool이 바닥났을 때 예외발생 전에 커넥션 할당 차단의 최대 시간 (단위: 밀리세컨드, 음수는 무제한 차단)</td></tr><tr><td>spring.redis.pool.min-idle</td><td>0</td><td>풀에서 관리하는 idle 커넥션의 최소 수 대상 (양수일 때만 유효)</td></tr><tr><td>spring.redis.port</td><td>6379</td><td>레디스 서버 포트</td></tr><tr><td>spring.redis.sentinel.master</td><td>레디스 서버 이름</td><td></td></tr><tr><td>spring.redis.sentinel.nodes</td><td>호스트:포트 쌍 목록 (콤마로 구분)</td><td></td></tr><tr><td>spring.redis.timeout</td><td>0</td><td>커넥션 타임아웃 (단위: 밀리세컨드)</td></tr></tbody></table><ol start="3"><li><strong>RedisConfig</strong> 를 설정합니다.</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span></span>
<span class="line"> </span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.redis.host}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> redisHost<span class="token punctuation">;</span></span>
<span class="line">	</span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.redis.port}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> redisPort<span class="token punctuation">;</span></span>
<span class="line">	</span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.redis.password}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> redisPassword<span class="token punctuation">;</span></span>
<span class="line">	</span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisConnectionFactory</span> <span class="token function">redisConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">RedisStandaloneConfiguration</span> redisStandaloneConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisStandaloneConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisStandaloneConfiguration<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span>redisHost<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisStandaloneConfiguration<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>redisPort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisStandaloneConfiguration<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>redisPassword<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">LettuceConnectionFactory</span> lettuceConnectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>redisStandaloneConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> lettuceConnectionFactory<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span><span class="token function">redisConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Redis 에 연결하기 위한 <code>RedisConnectionFactory</code> 와 <code>RedisTemplate</code> 입니다. redisTemplate 을 이용하여 Redis 를 사용합니다.</li></ul><ol start="4"><li><strong>RedisController</strong></li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">redis<span class="token punctuation">.</span>hello<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ValueOperations</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisController</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;Hello Redis&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/redisTest&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">addRedisKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> vop <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        vop<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;banana&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        vop<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;apple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        vop<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watermelon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/redisTest/{key}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRedisKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> vop <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> value <span class="token operator">=</span> vop<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>redisTemplate</code> 를 주입받습니다.</li><li><code>redisTemplate.opsForValue();</code> 으로 Redis 와 연결하여 key, value 를 넣고 꺼냅니다.</li></ul><ol start="5"><li><p><strong>Postman</strong> 으로 확인해보겠습니다.</p><ul><li>POST <code>http://localhost:8080/redisTest</code> : 201 응답이 잘 옵니다. Redis 에 잘 저장되었습니다.</li></ul><p><img src="/images/2023-04-18-rtr/image-20230418224045312.png" alt="image-20230418224045312"></p><ul><li>GET <code>http://localhost:8080/redisTest/yellow</code> : key 값인 <code>yellow</code> 를 넣었을 때 value 값인 <code>banana</code> 가 잘 출력됩니다.</li></ul><p><img src="/images/2023-04-18-rtr/image-20230418224220773.png" alt="image-20230418224220773"></p></li></ol><p>이를 활용해서 socceranalyst 프로젝트에 Redis 를 적용해보겠습니다.</p><h2 id="refreshtoken-과-redis" tabindex="-1"><a class="header-anchor" href="#refreshtoken-과-redis"><span>RefreshToken 과 Redis</span></a></h2><p>갑자기 Redis 를 언급한 이유는 <strong>RTR</strong> 적용을 위해서 refreshToken 을 Redis 에 저장하기 위함입니다. 다음에 언급할 주제이기도 한 RTR 은 Refresh Token Rotation 의 약자로, refreshToken 을 일회용으로 사용하고 폐기하는 정책입니다.</p><p>따라서 해당 refreshToken 을 유효한지 검증하고 처리하는 과정을 빠르게 하기 위해 Redis 를 사용하여 저장하고, 재발급 요청 시 DB 에 있는 refreshToken 인지 확인한 후에 재발급을 하게 됩니다.</p><h1 id="rtr-refresh-token-rotation" tabindex="-1"><a class="header-anchor" href="#rtr-refresh-token-rotation"><span>RTR (Refresh Token Rotation)</span></a></h1><p>JWT Token 은 보통 accessToken 과 refreshToken 으로 나눠 사용합니다. accessToken 은 인증 및 인가 권한을 가지며 만료시간이 짧습니다. refreshToken 은 만료기간이 길지만, accessToken 을 재발급하는 데만 사용됩니다.</p><h2 id="refreshtoken-의-보안성-문제" tabindex="-1"><a class="header-anchor" href="#refreshtoken-의-보안성-문제"><span>RefreshToken 의 보안성 문제</span></a></h2><p>하지만 이러한 Token 의 이원화에도 몇 가지 문제점이 있는데, 그 중 하나가 refreshToken 이 탈취당했을 때입니다. refreshToken 은 보통 2주의 만료기간을 가지니, 그 동안 attacker 는 계속해서 accessToken 을 발급받을 수 있습니다. Token 은 클라이언트의 상태를 보존하지 않는 stateless 상태이기 때문입니다.</p><h2 id="rtr-동작-flow" tabindex="-1"><a class="header-anchor" href="#rtr-동작-flow"><span>RTR 동작 flow</span></a></h2><p>RTR 정책이 동작하는 방식입니다.</p><p><img src="/images/2023-04-18-rtr/image-20230418233427108.png" alt="image-20230418233427108"></p><ol><li>client 는 ID, PW 로 로그인을 요청합니다.</li><li>서버는 <code>TokenProvider</code> 로 accessToken, refreshToken 을 발급합니다.</li><li>refreshToken 은 사용자의 ID 등 식별할 수 있는 값으로 key 를 정하여 Redis 에 저장합니다.</li><li>client 에게 accessToken, refreshToken 을 응답합니다.</li><li>server 가 client 에서 만료된 accessToken 을 받으면,</li><li>client 에게 401 에러를 반환합니다.</li><li>client 는 accessToken 이 만료되었음을 확인하고 refreshToken 을 전송합니다.</li><li>server 는 accessToken 에서 userID 를 key 로 하여 Redis 에서 refreshToken 을 조회합니다.</li><li>Redis 는 refreshToken 을 반환하고, server 는 이 값을 대조합니다.</li><li>해당 값이 맞으면 accessToken, refreshToken 을 재발급 하고 refreshToken 은 다시 Redis 에 저장합니다.</li><li>새로운 accessToken, refreshToken 을 client 에게 반환합니다.</li></ol><h2 id="attacker-에게-토큰을-탈취당할-경우" tabindex="-1"><a class="header-anchor" href="#attacker-에게-토큰을-탈취당할-경우"><span>Attacker 에게 토큰을 탈취당할 경우</span></a></h2><p><img src="/images/2023-04-18-rtr/image-20230418234122708.png" alt="image-20230418234122708"></p><ol><li>1번 accessToken, refreshToken 을 Attacker 에게 탈취당합니다.</li><li>1번 accessToken 만료 시 Attacker 는 재발급 요청을 합니다.</li><li>서버는 해당 토큰이 정상적이므로 Token 을 재발급하고 2번 refreshToken 은 Redis 에 저장합니다.</li><li>이후 재발급된 2번 accessToken, refreshToken 을 Attacker 에게 반환합니다.</li><li>Client 측도 accessToken 만료 시 1번 refreshToken 으로 server 에게 재발급 요청을 합니다.</li><li>이 때 Redis 에 저장된 refreshToken 은 2번이므로 1번 refreshToken 은 유효하지 않습니다. 따라서 server 는 client 에게 재로그인 요구를 합니다.</li><li>client 는 재로그인을 실시합니다.</li><li>server 는 로그인 시 새로운 accessToken, refreshToken 를 발급하므로, 3번 accessToken, refreshToken 을 발급하고 3번 refreshToken 은 Redis 저장합니다.</li><li>이후 재발급된 3번 accessToken, refreshToken 을 client 에게 반환합니다.</li><li>2번 accessToken 이 만료되었을 때 Attacker 는 다시 2번 refreshToken 으로 accessToken 재발급을 요청합니다.</li><li>server 는 Redis 조회 결과 2번 refreshToken 은 만료된 상태이므로 Attacker 에게 재로그인을 요구합니다.</li><li>Attacker 는 client 의 ID, PW 를 알 수 없으므로 재로그인에 실패하게 됩니다.</li></ol><h2 id="문제점" tabindex="-1"><a class="header-anchor" href="#문제점"><span>문제점</span></a></h2><ol><li>이러한 방법은 JWT의 Stateless 방식에 어긋나는 행동입니다. Redis 에 refreshToken 을 저장함으로써 서버가 클라이언트의 상태를 보존하고 있기 때문입니다.</li><li>Attacker 에게 accessToken, refreshToken 이 함께 탈취당했을 때 accessToken 이 만료되기 전까지 Attacker 는 사용자 정보에 접근할 수 있습니다. 이 점은 접속 IP 확인 등을 통해서 해결할 수도 있습니다.</li></ol><p><em><strong><u>보안에서 모든 상황을 만족할 수 없습니다. 적절한 Trade-off 가 필요합니다.</u></strong></em></p><h1 id="마치며" tabindex="-1"><a class="header-anchor" href="#마치며"><span>마치며</span></a></h1><p>Redis, RTR 의 개념적인 부분만 개략적으로 알아봤습니다.</p><ol><li>Redis 연동</li><li>RefreshToken 저장 및 조회 구현</li><li>Access Token 만료 시에만 새로운 Token을 발급 받을 수 있도록 구현. 그전에 발급받으려고 하면 Access, Refresh Token을 모두 폐기 <ul><li>Attacker 가 Refresh Token을 사용하여 일찍 Access Token을 발급받으려는 상황 방지</li></ul></li></ol><h1 id="ref" tabindex="-1"><a class="header-anchor" href="#ref"><span>Ref.</span></a></h1><p><a href="https://oingdaddy.tistory.com/239" target="_blank" rel="noopener noreferrer">Springboot + Redis 연동하는 초간단 샘플 만들어보기</a></p><p><a href="https://zangzangs.tistory.com/72" target="_blank" rel="noopener noreferrer">인메모리 데이터 저장소 Redis, 왜 사용할까? #Redis 파헤치기</a></p><p><a href="https://backtony.github.io/spring/redis/2021-08-29-spring-redis-1/" target="_blank" rel="noopener noreferrer">Spring - Redis 연동하기</a></p><nav class="vp-page-nav" aria-label="page navigation" data-v-63cabaa2><!----><!----></nav></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-eWaF2Kn4.js" defer></script>
  </body>
</html>
