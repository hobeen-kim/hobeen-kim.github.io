<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>SpringEvent 에서 트랜잭션 범위 설정 | 앤디 블로그</title><meta name="description" content="이벤트를 발행할 때 반드시 보장되어야할 행동과 그렇지 않은 행동을 구분해서 개발">
    <link rel="preload" href="/assets/style-Bh5D_Jjo.css" as="style"><link rel="stylesheet" href="/assets/style-Bh5D_Jjo.css">
    <link rel="modulepreload" href="/assets/app-dXp5MBUq.js"><link rel="modulepreload" href="/assets/2025-10-22-eventhandler.html-Dwipaaca.js">
    <link rel="prefetch" href="/assets/index.html-qDGlv6z5.js" as="script"><link rel="prefetch" href="/assets/index.html-DduAwnGf.js" as="script"><link rel="prefetch" href="/assets/index.html-nsvbb0aN.js" as="script"><link rel="prefetch" href="/assets/index.html-DJheZCGN.js" as="script"><link rel="prefetch" href="/assets/index.html-BdtnAAuU.js" as="script"><link rel="prefetch" href="/assets/2023-11-18-system.html-GfvyJmVb.js" as="script"><link rel="prefetch" href="/assets/2025-02-08-whatiswork.html-Dgn5LVxt.js" as="script"><link rel="prefetch" href="/assets/2025-02-11-kafka.html-Dhov9q5u.js" as="script"><link rel="prefetch" href="/assets/2025-02-16-object.html-B1ImFPFP.js" as="script"><link rel="prefetch" href="/assets/2025-03-03-skilloflove.html-O7FXA0M4.js" as="script"><link rel="prefetch" href="/assets/2025-03-08-terraform.html-DtBFKVkU.js" as="script"><link rel="prefetch" href="/assets/2025-03-09-software.html-Co-5dijK.js" as="script"><link rel="prefetch" href="/assets/2025-03-23-chosun.html-CuVpamc-.js" as="script"><link rel="prefetch" href="/assets/2025-08-31-unittest.html-CNcciNhv.js" as="script"><link rel="prefetch" href="/assets/2025-02-07-ze.html-DUNqYRBx.js" as="script"><link rel="prefetch" href="/assets/2025-02-10-firstlog.html-C1FFF1Br.js" as="script"><link rel="prefetch" href="/assets/2025-02-14-log.html-Cgdq-80_.js" as="script"><link rel="prefetch" href="/assets/2025-02-23-anna.html-IeMZ6JU2.js" as="script"><link rel="prefetch" href="/assets/2025-03-02-bystander.html-BV6D0UQr.js" as="script"><link rel="prefetch" href="/assets/2025-04-08-k8s.html-D_6m5tjd.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-log.html-YiEfWcBt.js" as="script"><link rel="prefetch" href="/assets/2025-08-18-coworker.html-BnaPPXGV.js" as="script"><link rel="prefetch" href="/assets/2025-02-25-aws.html-D5niZ3_c.js" as="script"><link rel="prefetch" href="/assets/2025-03-13-aws.html-ByWo2XMy.js" as="script"><link rel="prefetch" href="/assets/2025-03-20-aws.html-DEhFV8ky.js" as="script"><link rel="prefetch" href="/assets/index.html-C2o3k3i3.js" as="script"><link rel="prefetch" href="/assets/2025-08-26-culture1.html-BP3PkREi.js" as="script"><link rel="prefetch" href="/assets/2025-08-27-culturetest.html-DpFtrtL_.js" as="script"><link rel="prefetch" href="/assets/index.html-ByJiQK50.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-leteraljoin.html-HaxU26Sk.js" as="script"><link rel="prefetch" href="/assets/2025-09-30-likesearch.html-BcC3tGoc.js" as="script"><link rel="prefetch" href="/assets/index.html-uDJGFn60.js" as="script"><link rel="prefetch" href="/assets/2023-10-20-cpucredit.html-g7HB6UOA.js" as="script"><link rel="prefetch" href="/assets/2023-12-15-awslambda.html-CNNxtA76.js" as="script"><link rel="prefetch" href="/assets/2024-05-23-goodlog.html-CQyRZawn.js" as="script"><link rel="prefetch" href="/assets/2024-10-28-sg.html-BtqTJjQR.js" as="script"><link rel="prefetch" href="/assets/2025-01-24-eksdnsresolve.html-D5UE_zwd.js" as="script"><link rel="prefetch" href="/assets/2025-03-15-filesystem.html-CMA6BjOn.js" as="script"><link rel="prefetch" href="/assets/2025-05-04-awsregion.html-2XJet1u4.js" as="script"><link rel="prefetch" href="/assets/2025-09-03-kuberesource.html-Pl3ubtY5.js" as="script"><link rel="prefetch" href="/assets/2025-09-05-podeviction.html-BsBtn78s.js" as="script"><link rel="prefetch" href="/assets/2025-09-15-autoscaling.html-ASiuNjKh.js" as="script"><link rel="prefetch" href="/assets/2025-09-22-rollingupdate.html-0SiK414D.js" as="script"><link rel="prefetch" href="/assets/2025-09-29-loadtest.html-Bci1Aqzt.js" as="script"><link rel="prefetch" href="/assets/index.html-Ck3zHoSr.js" as="script"><link rel="prefetch" href="/assets/2025-09-17-hashmap.html-Ig0PBjua.js" as="script"><link rel="prefetch" href="/assets/2025-09-23-referencevalue.html-C71LCac1.js" as="script"><link rel="prefetch" href="/assets/2025-10-04-stringimmutable.html-CFIjpHQ0.js" as="script"><link rel="prefetch" href="/assets/2025-10-05-immutableclass.html-CqCeJVr7.js" as="script"><link rel="prefetch" href="/assets/2025-10-05-singleton.html-Bf-PAlrK.js" as="script"><link rel="prefetch" href="/assets/2025-10-16-gc.html-CLFcgjuH.js" as="script"><link rel="prefetch" href="/assets/index.html-BIizA5ZE.js" as="script"><link rel="prefetch" href="/assets/2025-01-18-kafkadocker.html-B3CuMYGK.js" as="script"><link rel="prefetch" href="/assets/index.html-CRcpfCxu.js" as="script"><link rel="prefetch" href="/assets/2023-04-12-validation.html-BQRf_pca.js" as="script"><link rel="prefetch" href="/assets/2023-04-18-rtr.html-DUA2FbTx.js" as="script"><link rel="prefetch" href="/assets/2023-04-25-mdc.html-CS5rZJ-L.js" as="script"><link rel="prefetch" href="/assets/2023-05-10-SpringRestDocs1.html-Cp7UbjVd.js" as="script"><link rel="prefetch" href="/assets/2023-05-13-SpringRestDocs2.html-XMIKDqKb.js" as="script"><link rel="prefetch" href="/assets/2023-05-14-SpringRestDocs3.html-BuZY54nr.js" as="script"><link rel="prefetch" href="/assets/2025-02-13-security.html-Dv_BQz-4.js" as="script"><link rel="prefetch" href="/assets/2025-06-25-alarm.html-Lx5U3ce6.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-Cj2ron2C.js" as="script"><link rel="prefetch" href="/assets/2025-08-05-test1.html-w5Lrt9Bp.js" as="script"><link rel="prefetch" href="/assets/2025-08-20-test2.html-BKeaqicM.js" as="script"><link rel="prefetch" href="/assets/2025-08-28-jsonproperty.html-CGk1tZNG.js" as="script"><link rel="prefetch" href="/assets/2025-09-08-sonarqube.html-DE_GryNx.js" as="script"><link rel="prefetch" href="/assets/index.html-D5xODuDi.js" as="script"><link rel="prefetch" href="/assets/2025-01-01-list.html-D1arYMcn.js" as="script"><link rel="prefetch" href="/assets/2025-06-27-iot.html-C1TbnrGM.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-e6Itn6q1.js" as="script"><link rel="prefetch" href="/assets/2025-08-13-mqtt.html-fq3EKFxC.js" as="script"><link rel="prefetch" href="/assets/2025-08-29-oidc.html-CSG6cZEw.js" as="script"><link rel="prefetch" href="/assets/2025-09-04-smtp.html-CR1uINqT.js" as="script"><link rel="prefetch" href="/assets/2025-09-16-cscd.html-DmzpZgYN.js" as="script"><link rel="prefetch" href="/assets/2025-09-18-flame.html-Ct5UqNXd.js" as="script"><link rel="prefetch" href="/assets/2025-10-01-keycloak.html-CZiJSDs_.js" as="script"><link rel="prefetch" href="/assets/index.html-DC3194gK.js" as="script"><link rel="prefetch" href="/assets/404.html-fF7WPKRA.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-BGEAWe8-.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">앤디 블로그</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/culture/" aria-label="개발 문화"><!--[--><!--[--><!--]--><!--]-->개발 문화<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/tech/" aria-label="기술"><!--[--><!--[--><!--]--><!--]-->기술<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="자바"><!--[--><!--[--><!--]--><!--]-->자바<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/infra/" aria-label="인프라"><!--[--><!--[--><!--]--><!--]-->인프라<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resume/" aria-label="이력서"><!--[--><!--[--><!--]--><!--]-->이력서<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/culture/" aria-label="개발 문화"><!--[--><!--[--><!--]--><!--]-->개발 문화<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/tech/" aria-label="기술"><!--[--><!--[--><!--]--><!--]-->기술<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="자바"><!--[--><!--[--><!--]--><!--]-->자바<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/infra/" aria-label="인프라"><!--[--><!--[--><!--]--><!--]-->인프라<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resume/" aria-label="이력서"><!--[--><!--[--><!--]--><!--]-->이력서<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">SpringEvent 에서 트랜잭션 범위 설정 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-문제-상황" aria-label="1. 문제 상황"><!--[--><!--[--><!--]--><!--]-->1. 문제 상황<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#문제점" aria-label="문제점"><!--[--><!--[--><!--]--><!--]-->문제점<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-해결" aria-label="2. 해결"><!--[--><!--[--><!--]--><!--]-->2. 해결<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#transactionaleventlistener-사용" aria-label="@TransactionalEventListener 사용"><!--[--><!--[--><!--]--><!--]-->@TransactionalEventListener 사용<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#propagation-requires-new-사용" aria-label="Propagation.REQUIRES_NEW 사용"><!--[--><!--[--><!--]--><!--]-->Propagation.REQUIRES_NEW 사용<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#결론" aria-label="결론"><!--[--><!--[--><!--]--><!--]-->결론<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#ref" aria-label="Ref."><!--[--><!--[--><!--]--><!--]-->Ref.<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><header class="page-header" data-v-84f05ea1><h1 class="title" data-v-84f05ea1>SpringEvent 에서 트랜잭션 범위 설정</h1><div class="meta" data-v-84f05ea1><time data-v-84f05ea1>2025년 10월 22일</time></div></header><nav class="table-of-contents"><ul><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#_1-문제-상황" class="router-link-active router-link-exact-active">1. 문제 상황</a><ul><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#문제점" class="router-link-active router-link-exact-active">문제점</a></li></ul></li><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#_2-해결" class="router-link-active router-link-exact-active">2. 해결</a><ul><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#transactionaleventlistener-사용" class="router-link-active router-link-exact-active">@TransactionalEventListener 사용</a></li><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#propagation-requires-new-사용" class="router-link-active router-link-exact-active">Propagation.REQUIRES_NEW 사용</a></li></ul></li><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#결론" class="router-link-active router-link-exact-active">결론</a></li><li><a aria-current="page" href="/posts/spring/2025-10-22-eventhandler.html#ref" class="router-link-active router-link-exact-active">Ref.</a></li></ul></nav><p>중심적인 도메인과 관련없는 도메인을 ApplicationEventPublisher 을 이용하여 이벤트를 발행해 분리시켜보자.</p><h1 id="_1-문제-상황" tabindex="-1"><a class="header-anchor" href="#_1-문제-상황"><span>1. 문제 상황</span></a></h1><p>다음과 같이 Post 를 생성하면 **<u>알림 서비스로 알림을 생성하는 코드</u>**가 있다.</p><p><img src="/images/2025-10-22-eventhandler/image-20251022153303967.png" alt="image-20251022153303967"></p><p>그럼 다음과 같이 코드를 짤 수 있다.</p><p><strong>NotificationService</strong></p><p>알림을 보내는 역할을 한다.</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">NotificationService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">val</span> notificationRepository<span class="token operator">:</span> NotificationRepository<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//알림발송 대신 알림저장으로 일단 구현했다.</span></span>
<span class="line">  	<span class="token annotation builtin">@Transactional</span></span>
<span class="line">    <span class="token keyword">fun</span> <span class="token function">notifyPostCreate</span><span class="token punctuation">(</span>event<span class="token operator">:</span> PostCreateEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">val</span> content <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>postId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> notified: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>title</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>content</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">        </span>
<span class="line">        notificationRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span></span>
<span class="line">            Notification<span class="token punctuation">.</span><span class="token function">createNotification</span><span class="token punctuation">(</span>content <span class="token operator">=</span> content<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PostService</strong></p><p>포스트를 생성하고 알림을 요청한다.</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">PostService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">val</span> postRepository<span class="token operator">:</span> PostRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">val</span> notificationService<span class="token operator">:</span> NotificationService<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation builtin">@Transactional</span></span>
<span class="line">    <span class="token keyword">fun</span> <span class="token function">createPost</span><span class="token punctuation">(</span>dto<span class="token operator">:</span> PostCreateApiDto<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">val</span> post <span class="token operator">=</span> Post<span class="token punctuation">.</span><span class="token function">createPost</span><span class="token punctuation">(</span></span>
<span class="line">            title <span class="token operator">=</span> dto<span class="token punctuation">.</span>title<span class="token punctuation">,</span></span>
<span class="line">            content <span class="token operator">=</span> dto<span class="token punctuation">.</span>content<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">val</span> savedPost <span class="token operator">=</span> postRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        notificationService<span class="token punctuation">.</span><span class="token function">notifyPostCreate</span><span class="token punctuation">(</span>PostCreateEvent<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>savedPost<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> savedPost<span class="token punctuation">.</span>postId</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="문제점" tabindex="-1"><a class="header-anchor" href="#문제점"><span>문제점</span></a></h2><p>여기엔 다음과 같은 문제점이 있다.</p><ol><li>notification 요청 코드가 실패하면 post 생성도 실패한다.</li><li>Post 입장에서 notification 전송과 강력하게 결합된다.</li></ol><p>1번 문제는 비동기로 호출하면 해결할 수 있다. 하지만 2번 문제는 <strong>비동기 호출만으로는 결합 문제가 해소되지 않는다.</strong> 비동기 호출을 <code>createPost()</code> 내부에서 트랜잭션 커밋 전에 실행하면, 알림에서 조회 시점/격리 문제도 생길 수 있다. <strong>결합 해소는 이벤트 발행으로, 롤백 경계 분리는 트랜잭션 전파로</strong> 설계해야 한다.</p><h1 id="_2-해결" tabindex="-1"><a class="header-anchor" href="#_2-해결"><span>2. 해결</span></a></h1><p>아래와 같이 <strong>Spring Application Event</strong> 를 활용해서 Post 와 Notification 을 구분해보자.</p><p><img src="/images/2025-10-22-eventhandler/image-20251022183706517.png" alt="image-20251022183706517"></p><p>Post 에서는 아래 방법으로 **&quot;post 가 생성되었다&quot;**는 이벤트만 발행한다.</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@Transactional</span></span>
<span class="line"><span class="token keyword">fun</span> <span class="token function">createPost</span><span class="token punctuation">(</span>dto<span class="token operator">:</span> PostCreateApiDto<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> saved <span class="token operator">=</span> postRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>Post<span class="token punctuation">.</span><span class="token function">createPost</span><span class="token punctuation">(</span>dto<span class="token punctuation">.</span>title<span class="token punctuation">,</span> dto<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    applicationEventPublisher<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span>PostCreatedEvent<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>saved<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> saved<span class="token punctuation">.</span>postId</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>그리고 Notification 에서는 <code>@EventListener</code> 로 이벤트를 구독한다.</p><blockquote><p><strong>발행 이벤트는 &quot;&quot;무엇이 일어났다(사실)&quot;를 표현</strong>해야 한다. 예) <code>PostCreatedEvent(postId, title, ...)</code> “알림을 발송하라” 같은 <strong>행동 지시</strong>는 Post 와 Notification 의 논리적인 의존성을 남긴다.</p></blockquote><p>하지만 이 경우에도 Notification 이 실패할 경우 Post 의 트랜잭션 또한 롤백될 수 있는데, 이는 @EventListener는 동기 실행이라, 리스너 예외가 퍼블리셔 트랜잭션을 롤백시키기 때문이다. 따라서 Post와 Notification 을 논리적으로 분리하더라도 물리(트랜잭션)적으로 결합된다. (<s>논리적으로 분리되면서 물리적으로 묶이는 아이러니</s>)</p><p><img src="/images/2025-10-22-eventhandler/image-20251022191334335.png" alt="image-20251022191334335"></p><h2 id="transactionaleventlistener-사용" tabindex="-1"><a class="header-anchor" href="#transactionaleventlistener-사용"><span>@TransactionalEventListener 사용</span></a></h2><p><code>@TransactionalEventListener</code> 는 이벤트가 트랜잭션 안에서 발행된 경우에만 동작한다(기본 fallbackExecution=false). 기본 값은 AFTER_COMMIT 이며, 이 경우 퍼블리셔 트랜잭션이 커밋된 뒤 리스너가 호출된다. 트랜잭션 밖에서 발행되면 리스너는 호출되지 않는다. 필요 시 @TransactionalEventListener(fallbackExecution = true) 로 비트랜잭션 상황도 처리할 수 있다(즉시 실행).</p><p><code>NotificationService</code> 에서 다음과 같이 사용할 수 있다.</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">NotificationService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">val</span> notificationRepository<span class="token operator">:</span> NotificationRepository<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">		<span class="token annotation builtin">@TransactionalEventListener</span><span class="token punctuation">(</span>phase <span class="token operator">=</span> TransactionPhase<span class="token punctuation">.</span>AFTER_COMMIT<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">fun</span> <span class="token function">notifyPostCreate</span><span class="token punctuation">(</span>event<span class="token operator">:</span> PostCreateEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">val</span> content <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>postId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> notified: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>title</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>content</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line">        notificationRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span></span>
<span class="line">            Notification<span class="token punctuation">.</span><span class="token function">createNotification</span><span class="token punctuation">(</span>content <span class="token operator">=</span> content<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>이제 &quot;<strong>이벤트 발행자의 트랜잭션이 커밋된 이후에만 notifyPostCreate 이 호출</strong>&quot;된다. 따라서 Post 의 저장은 알림 서비스의 실패와 관계없이 보장된다고 할 수 있다.</p><p>참고로 TransactionalEventListener 의 phase 값은 다음과 같다.</p><ul><li><strong>TransactionPhase.BEFORE_COMMIT</strong> : 트랜잭션 commit 직전에 수행</li><li><strong>TransactionPhase.AFTER_COMMIT</strong>(기본값) : 트랜잭션 commit 직후에 수행</li><li><strong>TransactionPhase.AFTER_ROLLBACK</strong> : 트랜잭션 rollback 직후 수행</li><li><strong>TransactionPhase.AFTER_COMPLETION</strong> : 트랜잭션이 완료된 후 수행 (commit 또는 rollback)</li></ul><p>여기서 주의할 건 트랜잭션 컨텍스트 내에서 수행되므로 <strong>트랜잭션이 없다면 리스너가 동작하지 않는다.</strong></p><h2 id="propagation-requires-new-사용" tabindex="-1"><a class="header-anchor" href="#propagation-requires-new-사용"><span>Propagation.REQUIRES_NEW 사용</span></a></h2><p>하지만 여기서 또 문제가 생긴다. post 에서 트랜잭션이 커밋되었으므로 notification 에서는 트랜잭션이 퍼블리셔와 동일하지 않다. 따라서 notifyPostCreate() 내에서 원하는 서비스 단위의 커밋 및 롤백이 보장되지 않게 된다. 이를 해결하기 위해 <code>Propagation</code> 옵션을 줄 수 있다.</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@TransactionalEventListener</span><span class="token punctuation">(</span>phase <span class="token operator">=</span> TransactionPhase<span class="token punctuation">.</span>AFTER_COMMIT<span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation builtin">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRES_NEW<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">fun</span> <span class="token function">notifyPostCreate</span><span class="token punctuation">(</span>event<span class="token operator">:</span> PostCreateEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> content <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>postId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> notified: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>title</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">event<span class="token punctuation">.</span>content</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line">    notificationRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span></span>
<span class="line">        Notification<span class="token punctuation">.</span><span class="token function">createNotification</span><span class="token punctuation">(</span>content <span class="token operator">=</span> content<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="결론" tabindex="-1"><a class="header-anchor" href="#결론"><span>결론</span></a></h1><p>최종적으로 아래와 같이 만들어진다.</p><p><img src="/images/2025-10-22-eventhandler/image-20251022192641599.png" alt="image-20251022192641599"></p><ul><li>Post 가 이벤트를 발행하고 Notification 이 수신하여 처리한다.</li><li><strong>Post 트랜잭션(작성)과 Notification 트랜잭션(알림 저장)은 <code>AFTER_COMMIT + REQUIRES_NEW</code>로 분리</strong>된다. <ul><li>Post 실패 → 이벤트 미발행(알림 시도 없음)</li><li>Notification 실패 → Post 커밋 유지, 알림만 롤백 및 재처리 전략으로 보완</li></ul></li><li>Post 가 실패하면 이벤트가 발행되지 않는다.</li></ul><h1 id="ref" tabindex="-1"><a class="header-anchor" href="#ref"><span>Ref.</span></a></h1><ul><li><a href="https://techblog.woowahan.com/7835/" target="_blank" rel="noopener noreferrer">회원시스템 이벤트기반 아키텍처 구축하기</a></li></ul><nav class="vp-page-nav" aria-label="page navigation" data-v-63cabaa2><!----><!----></nav></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-dXp5MBUq.js" defer></script>
  </body>
</html>
