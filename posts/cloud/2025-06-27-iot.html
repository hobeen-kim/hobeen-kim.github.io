<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>AWS IoT Core 완전 정복 - Shadow, 인증, Job까지 | 앤디  블로그 (블로그 공사중)🚧</title><meta name="description" content="AWS IoT Core의 핵심 개념들을 실무 예제와 함께 알아보자">
    <link rel="preload" href="/assets/style-DzLoKC0N.css" as="style"><link rel="stylesheet" href="/assets/style-DzLoKC0N.css">
    <link rel="modulepreload" href="/assets/app-e4ePmsVK.js"><link rel="modulepreload" href="/assets/2025-06-27-iot.html-BoDeQ9rL.js">
    <link rel="prefetch" href="/assets/index.html-CWz9JdvI.js" as="script"><link rel="prefetch" href="/assets/index.html-_dPx6QkE.js" as="script"><link rel="prefetch" href="/assets/index.html-emNtvZ9G.js" as="script"><link rel="prefetch" href="/assets/index.html-5fMn24s5.js" as="script"><link rel="prefetch" href="/assets/2025-02-08-whatiswork.html-DM1T2jJ9.js" as="script"><link rel="prefetch" href="/assets/2025-02-11-kafka.html-DMEgkeCy.js" as="script"><link rel="prefetch" href="/assets/2025-02-16-object.html-LC-E3Rom.js" as="script"><link rel="prefetch" href="/assets/2025-03-03-skilloflove.html-DXKqMMXK.js" as="script"><link rel="prefetch" href="/assets/2025-03-08-terraform.html-DX8KrxNl.js" as="script"><link rel="prefetch" href="/assets/2025-03-09-software.html-C-XBm_Yu.js" as="script"><link rel="prefetch" href="/assets/2025-03-23-chosun.html-Duo27d1c.js" as="script"><link rel="prefetch" href="/assets/2025-02-07-ze.html-B9UtU9fz.js" as="script"><link rel="prefetch" href="/assets/2025-02-10-firstlog.html-oAzuuEd2.js" as="script"><link rel="prefetch" href="/assets/2025-02-14-log.html-DIRgPo7X.js" as="script"><link rel="prefetch" href="/assets/2025-02-23-anna.html-CBO2KcYc.js" as="script"><link rel="prefetch" href="/assets/2025-03-02-bystander.html-gmYL-4Cc.js" as="script"><link rel="prefetch" href="/assets/2025-04-08-k8s.html-TasTh2Iq.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-log.html-B7pOoQvS.js" as="script"><link rel="prefetch" href="/assets/2025-03-15-filesystem.html-DtbA2NiC.js" as="script"><link rel="prefetch" href="/assets/2025-05-04-awsregion.html-Cae-BJ7y.js" as="script"><link rel="prefetch" href="/assets/index.html-Ds2mHhmL.js" as="script"><link rel="prefetch" href="/assets/2025-02-25-aws.html-CLmKbDJ7.js" as="script"><link rel="prefetch" href="/assets/2025-03-13-aws.html-BmcC1FAb.js" as="script"><link rel="prefetch" href="/assets/2025-03-20-aws.html-CSCu7ev5.js" as="script"><link rel="prefetch" href="/assets/index.html-DcpZ2F14.js" as="script"><link rel="prefetch" href="/assets/2025-04-20-leteraljoin.html-CdaB5zNS.js" as="script"><link rel="prefetch" href="/assets/index.html-DLHTIUrp.js" as="script"><link rel="prefetch" href="/assets/2025-02-03-post.html-BEXtuSdp.js" as="script"><link rel="prefetch" href="/assets/index.html-CnvTUyOl.js" as="script"><link rel="prefetch" href="/assets/2025-02-13-security.html-CIP7DDED.js" as="script"><link rel="prefetch" href="/assets/2025-06-25-alarm.html-By1uZvzD.js" as="script"><link rel="prefetch" href="/assets/2025-07-20-ssewebsocket.html-CReHWk7z.js" as="script"><link rel="prefetch" href="/assets/2025-08-05-test1.html-CrZD-roG.js" as="script"><link rel="prefetch" href="/assets/index.html-DgQ9QP87.js" as="script"><link rel="prefetch" href="/assets/404.html-efuSyCaM.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-78KHhXvM.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">앤디  블로그 (블로그 공사중)🚧</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/cloud/" aria-label="클라우드"><!--[--><!--[--><!--]--><!--]-->클라우드<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="글"><span class="title">글</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="글"><span class="title">글</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="모두"><!--[--><!--[--><!--]--><!--]-->모두<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/kafka/" aria-label="카프카"><!--[--><!--[--><!--]--><!--]-->카프카<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/spring/" aria-label="스프링"><!--[--><!--[--><!--]--><!--]-->스프링<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/cloud/" aria-label="클라우드"><!--[--><!--[--><!--]--><!--]-->클라우드<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/database/" aria-label="데이터베이스"><!--[--><!--[--><!--]--><!--]-->데이터베이스<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/posts/conference/" aria-label="컨퍼런스"><!--[--><!--[--><!--]--><!--]-->컨퍼런스<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/books/" aria-label="책"><!--[--><!--[--><!--]--><!--]-->책<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/logs/" aria-label="짧은 글"><!--[--><!--[--><!--]--><!--]-->짧은 글<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">AWS IoT Core 완전 정복 - Shadow, 인증, Job까지 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-shadow-디바이스-상태를-안전하게-관리하는-핵심-기능" aria-label="1. Shadow: 디바이스 상태를 안전하게 관리하는 핵심 기능"><!--[--><!--[--><!--]--><!--]-->1. Shadow: 디바이스 상태를 안전하게 관리하는 핵심 기능<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#shadow가-뭔가요" aria-label="Shadow가 뭔가요?"><!--[--><!--[--><!--]--><!--]-->Shadow가 뭔가요?<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#왜-필요한가" aria-label="왜 필요한가?"><!--[--><!--[--><!--]--><!--]-->왜 필요한가?<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#디바이스가-오프라인일-때" aria-label="디바이스가 오프라인일 때"><!--[--><!--[--><!--]--><!--]-->디바이스가 오프라인일 때<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#여러-앱에서-동시에-접근할-때" aria-label="여러 앱에서 동시에 접근할 때"><!--[--><!--[--><!--]--><!--]-->여러 앱에서 동시에 접근할 때<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#shadow의-구조" aria-label="Shadow의 구조"><!--[--><!--[--><!--]--><!--]-->Shadow의 구조<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#동기화-과정" aria-label="동기화 과정"><!--[--><!--[--><!--]--><!--]-->동기화 과정<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#named-shadow-vs-unnamed-shadow" aria-label="Named Shadow vs Unnamed Shadow"><!--[--><!--[--><!--]--><!--]-->Named Shadow vs Unnamed Shadow<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-인증서와-보안-iot-디바이스의-신원-증명" aria-label="2. 인증서와 보안: IoT 디바이스의 신원 증명"><!--[--><!--[--><!--]--><!--]-->2. 인증서와 보안: IoT 디바이스의 신원 증명<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#필수-인증서-파일들" aria-label="필수 인증서 파일들"><!--[--><!--[--><!--]--><!--]-->필수 인증서 파일들<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-certificate-pem-crt-클라이언트-인증서" aria-label="1. certificate.pem.crt (클라이언트 인증서)"><!--[--><!--[--><!--]--><!--]-->1. certificate.pem.crt (클라이언트 인증서)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-private-key-pem-개인-키" aria-label="2. private-key.pem (개인 키)"><!--[--><!--[--><!--]--><!--]-->2. private-key.pem (개인 키)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_3-rootca1-pem-루트-인증서" aria-label="3. rootCA1.pem (루트 인증서)"><!--[--><!--[--><!--]--><!--]-->3. rootCA1.pem (루트 인증서)<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#tls-mutual-authentication-과정" aria-label="TLS Mutual Authentication 과정"><!--[--><!--[--><!--]--><!--]-->TLS Mutual Authentication 과정<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1단계-서버-인증-디바이스-→-aws-검증" aria-label="1단계: 서버 인증 (디바이스 → AWS 검증)"><!--[--><!--[--><!--]--><!--]-->1단계: 서버 인증 (디바이스 → AWS 검증)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2단계-클라이언트-인증-aws-→-디바이스-검증" aria-label="2단계: 클라이언트 인증 (AWS → 디바이스 검증)"><!--[--><!--[--><!--]--><!--]-->2단계: 클라이언트 인증 (AWS → 디바이스 검증)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_3단계-tls-세션-성립" aria-label="3단계: TLS 세션 성립"><!--[--><!--[--><!--]--><!--]-->3단계: TLS 세션 성립<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_3-실제-python-코드로-보는-shadow-활용" aria-label="3. 실제 Python 코드로 보는 Shadow 활용"><!--[--><!--[--><!--]--><!--]-->3. 실제 Python 코드로 보는 Shadow 활용<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#기본-연결-설정" aria-label="기본 연결 설정"><!--[--><!--[--><!--]--><!--]-->기본 연결 설정<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#shadow-콜백-함수들" aria-label="Shadow 콜백 함수들"><!--[--><!--[--><!--]--><!--]-->Shadow 콜백 함수들<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#delta-콜백-원격-제어-받기" aria-label="Delta 콜백: 원격 제어 받기"><!--[--><!--[--><!--]--><!--]-->Delta 콜백: 원격 제어 받기<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#update-콜백-상태-업데이트-결과-확인" aria-label="Update 콜백: 상태 업데이트 결과 확인"><!--[--><!--[--><!--]--><!--]-->Update 콜백: 상태 업데이트 결과 확인<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#실무-팁" aria-label="실무 팁"><!--[--><!--[--><!--]--><!--]-->실무 팁<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#연결-안정성-향상" aria-label="연결 안정성 향상"><!--[--><!--[--><!--]--><!--]-->연결 안정성 향상<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#에러-처리" aria-label="에러 처리"><!--[--><!--[--><!--]--><!--]-->에러 처리<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-job-대규모-디바이스-관리의-핵심" aria-label="4. Job: 대규모 디바이스 관리의 핵심"><!--[--><!--[--><!--]--><!--]-->4. Job: 대규모 디바이스 관리의 핵심<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#job이-필요한-이유" aria-label="Job이 필요한 이유"><!--[--><!--[--><!--]--><!--]-->Job이 필요한 이유<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#shadow-vs-job-비교" aria-label="Shadow vs Job 비교"><!--[--><!--[--><!--]--><!--]-->Shadow vs Job 비교<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#job-document-구조" aria-label="Job Document 구조"><!--[--><!--[--><!--]--><!--]-->Job Document 구조<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#예시-1-펌웨어-업데이트" aria-label="예시 1: 펌웨어 업데이트"><!--[--><!--[--><!--]--><!--]-->예시 1: 펌웨어 업데이트<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#예시-2-설정-변경" aria-label="예시 2: 설정 변경"><!--[--><!--[--><!--]--><!--]-->예시 2: 설정 변경<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#예시-3-단순-명령" aria-label="예시 3: 단순 명령"><!--[--><!--[--><!--]--><!--]-->예시 3: 단순 명령<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#job-생성-및-관리" aria-label="Job 생성 및 관리"><!--[--><!--[--><!--]--><!--]-->Job 생성 및 관리<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#cli로-job-생성" aria-label="CLI로 Job 생성"><!--[--><!--[--><!--]--><!--]-->CLI로 Job 생성<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#디바이스에서-job-처리" aria-label="디바이스에서 Job 처리"><!--[--><!--[--><!--]--><!--]-->디바이스에서 Job 처리<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_5-실무에서-배운-교훈들" aria-label="5. 실무에서 배운 교훈들"><!--[--><!--[--><!--]--><!--]-->5. 실무에서 배운 교훈들<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#디바이스-오프라인-대응" aria-label="디바이스 오프라인 대응"><!--[--><!--[--><!--]--><!--]-->디바이스 오프라인 대응<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#대규모-배포시-주의사항" aria-label="대규모 배포시 주의사항"><!--[--><!--[--><!--]--><!--]-->대규모 배포시 주의사항<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#보안-관련-팁" aria-label="보안 관련 팁"><!--[--><!--[--><!--]--><!--]-->보안 관련 팁<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-인증서-로테이션" aria-label="1. 인증서 로테이션"><!--[--><!--[--><!--]--><!--]-->1. 인증서 로테이션<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-정책-최소권한-원칙" aria-label="2. 정책 최소권한 원칙"><!--[--><!--[--><!--]--><!--]-->2. 정책 최소권한 원칙<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#_6-메시지-크기-최적화-비용-절약의-핵심" aria-label="6. 메시지 크기 최적화: 비용 절약의 핵심"><!--[--><!--[--><!--]--><!--]-->6. 메시지 크기 최적화: 비용 절약의 핵심<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#aws-iot-core-실제-과금-방식" aria-label="AWS IoT Core 실제 과금 방식"><!--[--><!--[--><!--]--><!--]-->AWS IoT Core 실제 과금 방식<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#실제-과금-구조" aria-label="실제 과금 구조"><!--[--><!--[--><!--]--><!--]-->실제 과금 구조<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#실제-비용-영향-사례" aria-label="실제 비용 영향 사례"><!--[--><!--[--><!--]--><!--]-->실제 비용 영향 사례<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#before-최적화-8kb-센서-데이터" aria-label="Before 최적화 (8KB 센서 데이터)"><!--[--><!--[--><!--]--><!--]-->Before 최적화 (8KB 센서 데이터)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#after-최적화-4-2kb-압축-데이터" aria-label="After 최적화 (4.2KB 압축 데이터)"><!--[--><!--[--><!--]--><!--]-->After 최적화 (4.2KB 압축 데이터)<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#월별-비용-차이-계산" aria-label="월별 비용 차이 계산"><!--[--><!--[--><!--]--><!--]-->월별 비용 차이 계산<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_8kb-메시지-최적화-전" aria-label="8KB 메시지 (최적화 전)"><!--[--><!--[--><!--]--><!--]-->8KB 메시지 (최적화 전)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-2kb-메시지-최적화-후" aria-label="4.2KB 메시지 (최적화 후)"><!--[--><!--[--><!--]--><!--]-->4.2KB 메시지 (최적화 후)<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#실무-최적화-기법들" aria-label="실무 최적화 기법들"><!--[--><!--[--><!--]--><!--]-->실무 최적화 기법들<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#_1-json-키-이름-축약" aria-label="1. JSON 키 이름 축약"><!--[--><!--[--><!--]--><!--]-->1. JSON 키 이름 축약<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_2-데이터-타입-최적화" aria-label="2. 데이터 타입 최적화"><!--[--><!--[--><!--]--><!--]-->2. 데이터 타입 최적화<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_3-배열-데이터-압축" aria-label="3. 배열 데이터 압축"><!--[--><!--[--><!--]--><!--]-->3. 배열 데이터 압축<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#_4-gzip-압축-활용" aria-label="4. GZIP 압축 활용"><!--[--><!--[--><!--]--><!--]-->4. GZIP 압축 활용<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#메시지-크기-모니터링-도구" aria-label="메시지 크기 모니터링 도구"><!--[--><!--[--><!--]--><!--]-->메시지 크기 모니터링 도구<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#배치-전송으로-효율성-극대화" aria-label="배치 전송으로 효율성 극대화"><!--[--><!--[--><!--]--><!--]-->배치 전송으로 효율성 극대화<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#다른-aws-iot-서비스들도-마찬가지" aria-label="다른 AWS IoT 서비스들도 마찬가지"><!--[--><!--[--><!--]--><!--]-->다른 AWS IoT 서비스들도 마찬가지<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="#device-shadow" aria-label="Device Shadow"><!--[--><!--[--><!--]--><!--]-->Device Shadow<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="#rules-engine" aria-label="Rules Engine"><!--[--><!--[--><!--]--><!--]-->Rules Engine<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="#핵심-권장사항" aria-label="핵심 권장사항"><!--[--><!--[--><!--]--><!--]-->핵심 권장사항<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><header class="page-header" data-v-84f05ea1><h1 class="title" data-v-84f05ea1>AWS IoT Core 완전 정복 - Shadow, 인증, Job까지</h1><div class="meta" data-v-84f05ea1><time data-v-84f05ea1>2025년 6월 27일</time></div></header><nav class="table-of-contents"><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_1-shadow-디바이스-상태를-안전하게-관리하는-핵심-기능" class="router-link-active router-link-exact-active">1. Shadow: 디바이스 상태를 안전하게 관리하는 핵심 기능</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#shadow가-뭔가요" class="router-link-active router-link-exact-active">Shadow가 뭔가요?</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#왜-필요한가" class="router-link-active router-link-exact-active">왜 필요한가?</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#디바이스가-오프라인일-때" class="router-link-active router-link-exact-active">디바이스가 오프라인일 때</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#여러-앱에서-동시에-접근할-때" class="router-link-active router-link-exact-active">여러 앱에서 동시에 접근할 때</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#shadow의-구조" class="router-link-active router-link-exact-active">Shadow의 구조</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#동기화-과정" class="router-link-active router-link-exact-active">동기화 과정</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#named-shadow-vs-unnamed-shadow" class="router-link-active router-link-exact-active">Named Shadow vs Unnamed Shadow</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_2-인증서와-보안-iot-디바이스의-신원-증명" class="router-link-active router-link-exact-active">2. 인증서와 보안: IoT 디바이스의 신원 증명</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#필수-인증서-파일들" class="router-link-active router-link-exact-active">필수 인증서 파일들</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_1-certificate-pem-crt-클라이언트-인증서" class="router-link-active router-link-exact-active">1. certificate.pem.crt (클라이언트 인증서)</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_2-private-key-pem-개인-키" class="router-link-active router-link-exact-active">2. private-key.pem (개인 키)</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_3-rootca1-pem-루트-인증서" class="router-link-active router-link-exact-active">3. rootCA1.pem (루트 인증서)</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#tls-mutual-authentication-과정" class="router-link-active router-link-exact-active">TLS Mutual Authentication 과정</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_1단계-서버-인증-디바이스-→-aws-검증" class="router-link-active router-link-exact-active">1단계: 서버 인증 (디바이스 → AWS 검증)</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_2단계-클라이언트-인증-aws-→-디바이스-검증" class="router-link-active router-link-exact-active">2단계: 클라이언트 인증 (AWS → 디바이스 검증)</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_3단계-tls-세션-성립" class="router-link-active router-link-exact-active">3단계: TLS 세션 성립</a></li></ul></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_3-실제-python-코드로-보는-shadow-활용" class="router-link-active router-link-exact-active">3. 실제 Python 코드로 보는 Shadow 활용</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#기본-연결-설정" class="router-link-active router-link-exact-active">기본 연결 설정</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#shadow-콜백-함수들" class="router-link-active router-link-exact-active">Shadow 콜백 함수들</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#delta-콜백-원격-제어-받기" class="router-link-active router-link-exact-active">Delta 콜백: 원격 제어 받기</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#update-콜백-상태-업데이트-결과-확인" class="router-link-active router-link-exact-active">Update 콜백: 상태 업데이트 결과 확인</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#실무-팁" class="router-link-active router-link-exact-active">실무 팁</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#연결-안정성-향상" class="router-link-active router-link-exact-active">연결 안정성 향상</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#에러-처리" class="router-link-active router-link-exact-active">에러 처리</a></li></ul></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_4-job-대규모-디바이스-관리의-핵심" class="router-link-active router-link-exact-active">4. Job: 대규모 디바이스 관리의 핵심</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#job이-필요한-이유" class="router-link-active router-link-exact-active">Job이 필요한 이유</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#shadow-vs-job-비교" class="router-link-active router-link-exact-active">Shadow vs Job 비교</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#job-document-구조" class="router-link-active router-link-exact-active">Job Document 구조</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#예시-1-펌웨어-업데이트" class="router-link-active router-link-exact-active">예시 1: 펌웨어 업데이트</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#예시-2-설정-변경" class="router-link-active router-link-exact-active">예시 2: 설정 변경</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#예시-3-단순-명령" class="router-link-active router-link-exact-active">예시 3: 단순 명령</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#job-생성-및-관리" class="router-link-active router-link-exact-active">Job 생성 및 관리</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#cli로-job-생성" class="router-link-active router-link-exact-active">CLI로 Job 생성</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#디바이스에서-job-처리" class="router-link-active router-link-exact-active">디바이스에서 Job 처리</a></li></ul></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_5-실무에서-배운-교훈들" class="router-link-active router-link-exact-active">5. 실무에서 배운 교훈들</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#디바이스-오프라인-대응" class="router-link-active router-link-exact-active">디바이스 오프라인 대응</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#대규모-배포시-주의사항" class="router-link-active router-link-exact-active">대규모 배포시 주의사항</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#보안-관련-팁" class="router-link-active router-link-exact-active">보안 관련 팁</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_1-인증서-로테이션" class="router-link-active router-link-exact-active">1. 인증서 로테이션</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_2-정책-최소권한-원칙" class="router-link-active router-link-exact-active">2. 정책 최소권한 원칙</a></li></ul></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_6-메시지-크기-최적화-비용-절약의-핵심" class="router-link-active router-link-exact-active">6. 메시지 크기 최적화: 비용 절약의 핵심</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#aws-iot-core-실제-과금-방식" class="router-link-active router-link-exact-active">AWS IoT Core 실제 과금 방식</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#실제-과금-구조" class="router-link-active router-link-exact-active">실제 과금 구조</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#실제-비용-영향-사례" class="router-link-active router-link-exact-active">실제 비용 영향 사례</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#before-최적화-8kb-센서-데이터" class="router-link-active router-link-exact-active">Before 최적화 (8KB 센서 데이터)</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#after-최적화-4-2kb-압축-데이터" class="router-link-active router-link-exact-active">After 최적화 (4.2KB 압축 데이터)</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#월별-비용-차이-계산" class="router-link-active router-link-exact-active">월별 비용 차이 계산</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_8kb-메시지-최적화-전" class="router-link-active router-link-exact-active">8KB 메시지 (최적화 전)</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_4-2kb-메시지-최적화-후" class="router-link-active router-link-exact-active">4.2KB 메시지 (최적화 후)</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#실무-최적화-기법들" class="router-link-active router-link-exact-active">실무 최적화 기법들</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_1-json-키-이름-축약" class="router-link-active router-link-exact-active">1. JSON 키 이름 축약</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_2-데이터-타입-최적화" class="router-link-active router-link-exact-active">2. 데이터 타입 최적화</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_3-배열-데이터-압축" class="router-link-active router-link-exact-active">3. 배열 데이터 압축</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#_4-gzip-압축-활용" class="router-link-active router-link-exact-active">4. GZIP 압축 활용</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#메시지-크기-모니터링-도구" class="router-link-active router-link-exact-active">메시지 크기 모니터링 도구</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#배치-전송으로-효율성-극대화" class="router-link-active router-link-exact-active">배치 전송으로 효율성 극대화</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#다른-aws-iot-서비스들도-마찬가지" class="router-link-active router-link-exact-active">다른 AWS IoT 서비스들도 마찬가지</a><ul><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#device-shadow" class="router-link-active router-link-exact-active">Device Shadow</a></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#rules-engine" class="router-link-active router-link-exact-active">Rules Engine</a></li></ul></li><li><a aria-current="page" href="/posts/cloud/2025-06-27-iot.html#핵심-권장사항" class="router-link-active router-link-exact-active">핵심 권장사항</a></li></ul></li></ul></nav><header class="page-header" data-v-84f05ea1><h1 class="title" data-v-84f05ea1>AWS IoT Core 완전 정복 - Shadow, 인증, Job까지</h1><div class="meta" data-v-84f05ea1><time data-v-84f05ea1>2025년 6월 27일</time></div></header><p>최근 IoT 프로젝트를 진행하면서 AWS IoT Core를 깊이 사용하게 되었다. 처음엔 단순히 디바이스를 클라우드에 연결하는 정도로 생각했는데, 막상 써보니 Shadow, 인증서, Job 등 알아야 할 개념들이 생각보다 많았다. 특히 Shadow의 경우 처음엔 &quot;왜 굳이?&quot;라는 생각이 들었지만, 실제 디바이스가 오프라인 상황을 겪어보니 그 필요성을 절실히 느꼈다.</p><p>이번 글에서는 AWS IoT Core의 핵심 개념들을 실무에서 겪은 경험을 바탕으로 정리해보려고 한다.</p><hr><h1 id="_1-shadow-디바이스-상태를-안전하게-관리하는-핵심-기능" tabindex="-1"><a class="header-anchor" href="#_1-shadow-디바이스-상태를-안전하게-관리하는-핵심-기능"><span>1. Shadow: 디바이스 상태를 안전하게 관리하는 핵심 기능</span></a></h1><h2 id="shadow가-뭔가요" tabindex="-1"><a class="header-anchor" href="#shadow가-뭔가요"><span>Shadow가 뭔가요?</span></a></h2><p>AWS IoT Core의 Shadow는 <strong>디바이스의 상태를 클라우드에 저장해 놓은 JSON 문서</strong>다. 간단히 말해, 우리집 IoT 전구의 현재 상태(켜짐/꺼짐, 밝기 등)를 AWS 클라우드에 복사본으로 저장해두는 것이다.</p><p><img src="/images/2025-06-27-iot/image-20250627105439418.png" alt="image-20250627105439418"></p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;desired&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;power&quot;</span><span class="token operator">:</span> <span class="token string">&quot;on&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;brightness&quot;</span><span class="token operator">:</span> <span class="token number">70</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;reported&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;power&quot;</span><span class="token operator">:</span> <span class="token string">&quot;on&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">      <span class="token property">&quot;brightness&quot;</span><span class="token operator">:</span> <span class="token number">70</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>...<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">1629393746</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="왜-필요한가" tabindex="-1"><a class="header-anchor" href="#왜-필요한가"><span>왜 필요한가?</span></a></h2><p>처음엔 &quot;디바이스에 직접 명령 보내면 되는데 왜 굳이?&quot;라고 생각했다. 하지만 실제 IoT 환경에서는 다음과 같은 상황들이 빈번히 발생한다:</p><h3 id="디바이스가-오프라인일-때" tabindex="-1"><a class="header-anchor" href="#디바이스가-오프라인일-때"><span>디바이스가 오프라인일 때</span></a></h3><ul><li>사용자가 앱에서 &quot;전구 켜줘&quot;라고 명령</li><li>하지만 전구가 인터넷 연결이 끊어진 상태</li><li>Shadow에 <code>&quot;desired&quot;: {&quot;power&quot;: &quot;on&quot;}</code>을 저장</li><li>전구가 다시 온라인 되면 Shadow를 확인하고 상태를 동기화</li></ul><h3 id="여러-앱에서-동시에-접근할-때" tabindex="-1"><a class="header-anchor" href="#여러-앱에서-동시에-접근할-때"><span>여러 앱에서 동시에 접근할 때</span></a></h3><ul><li>가족 구성원들이 각자의 스마트폰으로 같은 IoT 기기 제어</li><li>Shadow가 중앙 상태 저장소 역할</li><li>누가 어디서 바꿔도 모든 앱이 동일한 상태 확인 가능</li></ul><h2 id="shadow의-구조" tabindex="-1"><a class="header-anchor" href="#shadow의-구조"><span>Shadow의 구조</span></a></h2><p>Shadow는 크게 3가지 상태로 구성된다:</p><table><thead><tr><th>필드</th><th>설명</th><th>예시</th></tr></thead><tbody><tr><td><code>desired</code></td><td>사용자가 원하는 상태</td><td>앱에서 &quot;밝기를 70%로&quot; 설정</td></tr><tr><td><code>reported</code></td><td>디바이스가 실제 보고한 상태</td><td>전구에서 &quot;현재 밝기 70%&quot; 보고</td></tr><tr><td><code>delta</code></td><td>차이값 (AWS가 자동 생성)</td><td>desired ≠ reported일 때만 존재</td></tr></tbody></table><h3 id="동기화-과정" tabindex="-1"><a class="header-anchor" href="#동기화-과정"><span>동기화 과정</span></a></h3><ol><li>사용자 앱이 <code>&quot;power&quot;: &quot;on&quot;</code> → Shadow의 <code>desired</code> 업데이트</li><li>Shadow는 <code>delta</code> 자동 생성 (<code>&quot;power&quot;: &quot;on&quot;</code>)</li><li>디바이스가 <code>delta</code> MQTT 메시지를 구독하고 상태 변경</li><li>디바이스가 실제로 켜지면 <code>reported</code>에 <code>&quot;power&quot;: &quot;on&quot;</code> 업데이트</li><li><code>desired</code>와 <code>reported</code>가 같아지면 <code>delta</code> 자동 제거</li></ol><h2 id="named-shadow-vs-unnamed-shadow" tabindex="-1"><a class="header-anchor" href="#named-shadow-vs-unnamed-shadow"><span>Named Shadow vs Unnamed Shadow</span></a></h2><p>처음 AWS IoT를 사용할 때는 기본 Shadow(Unnamed)만 사용했는데, 복잡한 디바이스를 다루다 보니 Named Shadow의 필요성을 느꼈다.</p><table><thead><tr><th>구분</th><th>Unnamed Shadow</th><th>Named Shadow</th></tr></thead><tbody><tr><td>개수</td><td>디바이스당 1개</td><td>디바이스당 여러 개 가능</td></tr><tr><td>용도</td><td>간단한 상태 관리</td><td>복합적인 상태 분리 관리</td></tr><tr><td>예시</td><td>전체 전원 상태</td><td><code>temp-sensor</code>, <code>fan-config</code>, <code>security-mode</code> 등</td></tr></tbody></table><p>예를 들어, 스마트 에어컨의 경우:</p><ul><li><code>temp-control</code>: 온도 관련 설정</li><li><code>fan-speed</code>: 풍속 관련 설정</li><li><code>timer-config</code>: 타이머 관련 설정</li></ul><p>이렇게 기능별로 Shadow를 분리하면 각 기능의 상태를 독립적으로 관리할 수 있어 훨씬 깔끔하다.</p><hr><h1 id="_2-인증서와-보안-iot-디바이스의-신원-증명" tabindex="-1"><a class="header-anchor" href="#_2-인증서와-보안-iot-디바이스의-신원-증명"><span>2. 인증서와 보안: IoT 디바이스의 신원 증명</span></a></h1><h2 id="필수-인증서-파일들" tabindex="-1"><a class="header-anchor" href="#필수-인증서-파일들"><span>필수 인증서 파일들</span></a></h2><p>AWS IoT에 디바이스를 연결하려면 3개의 파일이 반드시 필요하다:</p><p><img src="/images/2025-06-27-iot/image-20250627110412819.png" alt="image-20250627110412819"></p><h3 id="_1-certificate-pem-crt-클라이언트-인증서" tabindex="-1"><a class="header-anchor" href="#_1-certificate-pem-crt-클라이언트-인증서"><span>1. <code>certificate.pem.crt</code> (클라이언트 인증서)</span></a></h3><ul><li>디바이스의 신원을 증명하는 X.509 인증서</li><li>&quot;이 디바이스가 정말 우리가 등록한 디바이스가 맞나요?&quot;를 확인</li></ul><h3 id="_2-private-key-pem-개인-키" tabindex="-1"><a class="header-anchor" href="#_2-private-key-pem-개인-키"><span>2. <code>private-key.pem</code> (개인 키)</span></a></h3><ul><li>인증서와 쌍을 이루는 비밀키</li><li><strong>절대 유출되면 안 되는 파일</strong> (이 키가 탈취되면 디바이스 권한 탈취됨)</li></ul><h3 id="_3-rootca1-pem-루트-인증서" tabindex="-1"><a class="header-anchor" href="#_3-rootca1-pem-루트-인증서"><span>3. <code>rootCA1.pem</code> (루트 인증서)</span></a></h3><ul><li>AWS IoT Core 서버의 신원을 검증하는 용도</li><li>&quot;내가 연결하려는 서버가 정말 AWS 서버가 맞나요?&quot;를 확인</li></ul><h2 id="tls-mutual-authentication-과정" tabindex="-1"><a class="header-anchor" href="#tls-mutual-authentication-과정"><span>TLS Mutual Authentication 과정</span></a></h2><p>디바이스와 AWS IoT Core 간의 연결은 양방향 인증으로 이루어진다:</p><h3 id="_1단계-서버-인증-디바이스-→-aws-검증" tabindex="-1"><a class="header-anchor" href="#_1단계-서버-인증-디바이스-→-aws-검증"><span>1단계: 서버 인증 (디바이스 → AWS 검증)</span></a></h3><ul><li>AWS가 자신의 서버 인증서를 디바이스에 전송</li><li>디바이스가 <code>rootCA1.pem</code>으로 AWS 서버 신원 검증</li><li>&quot;연결하려는 서버가 진짜 AWS가 맞나?&quot; 확인</li></ul><h3 id="_2단계-클라이언트-인증-aws-→-디바이스-검증" tabindex="-1"><a class="header-anchor" href="#_2단계-클라이언트-인증-aws-→-디바이스-검증"><span>2단계: 클라이언트 인증 (AWS → 디바이스 검증)</span></a></h3><ul><li>디바이스가 <code>certificate.pem.crt</code>를 AWS에 전송</li><li>AWS가 등록된 인증서인지 확인하고 연결된 정책 검사</li><li>&quot;이 디바이스가 연결할 권한이 있나?&quot; 확인</li></ul><h3 id="_3단계-tls-세션-성립" tabindex="-1"><a class="header-anchor" href="#_3단계-tls-세션-성립"><span>3단계: TLS 세션 성립</span></a></h3><ul><li>양방향 인증 완료 후 암호화된 MQTT 통신 시작</li></ul><p>실제 Python 코드에서는 이렇게 설정한다:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">shadow_client<span class="token punctuation">.</span>configureCredentials<span class="token punctuation">(</span></span>
<span class="line">    root_ca_path<span class="token punctuation">,</span>      <span class="token comment"># AWS 서버 검증용</span></span>
<span class="line">    private_key_path<span class="token punctuation">,</span>  <span class="token comment"># 디바이스 서명용</span></span>
<span class="line">    cert_path         <span class="token comment"># 디바이스 신원 증명용</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h1 id="_3-실제-python-코드로-보는-shadow-활용" tabindex="-1"><a class="header-anchor" href="#_3-실제-python-코드로-보는-shadow-활용"><span>3. 실제 Python 코드로 보는 Shadow 활용</span></a></h1><p>실무에서 사용한 코드를 기반으로 Shadow 활용법을 살펴보자.</p><h2 id="기본-연결-설정" tabindex="-1"><a class="header-anchor" href="#기본-연결-설정"><span>기본 연결 설정</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">from</span> AWSIoTPythonSDK<span class="token punctuation">.</span>MQTTLib <span class="token keyword">import</span> AWSIoTMQTTShadowClient</span>
<span class="line"></span>
<span class="line"><span class="token comment"># AWS IoT 설정</span></span>
<span class="line">ENDPOINT <span class="token operator">=</span> <span class="token string">&quot;your-endpoint.iot.ap-northeast-2.amazonaws.com&quot;</span></span>
<span class="line">CLIENT_ID <span class="token operator">=</span> <span class="token string">&quot;my_device&quot;</span></span>
<span class="line">THING_NAME <span class="token operator">=</span> <span class="token string">&quot;my_device&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 인증서 파일 경로</span></span>
<span class="line">CERT_PATH <span class="token operator">=</span> <span class="token string">&quot;certificate.pem.crt&quot;</span></span>
<span class="line">PRIVATE_KEY_PATH <span class="token operator">=</span> <span class="token string">&quot;private.pem.key&quot;</span></span>
<span class="line">ROOT_CA_PATH <span class="token operator">=</span> <span class="token string">&quot;AmazonRootCA1.pem&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="shadow-콜백-함수들" tabindex="-1"><a class="header-anchor" href="#shadow-콜백-함수들"><span>Shadow 콜백 함수들</span></a></h2><h3 id="delta-콜백-원격-제어-받기" tabindex="-1"><a class="header-anchor" href="#delta-콜백-원격-제어-받기"><span>Delta 콜백: 원격 제어 받기</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">shadow_callback_delta</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> responseStatus<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;desired 상태가 변경될 때 호출&quot;&quot;&quot;</span></span>
<span class="line">    payload_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>payload<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token string">&quot;state&quot;</span> <span class="token keyword">in</span> payload_dict <span class="token keyword">and</span> <span class="token string">&quot;power&quot;</span> <span class="token keyword">in</span> payload_dict<span class="token punctuation">[</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span></span>
<span class="line">        desired_power <span class="token operator">=</span> payload_dict<span class="token punctuation">[</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;power&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;원격 명령 수신: power = </span><span class="token interpolation"><span class="token punctuation">{</span>desired_power<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 실제 디바이스 상태 변경</span></span>
<span class="line">        DEVICE_STATE<span class="token punctuation">[</span><span class="token string">&quot;power&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> desired_power</span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 특별한 동작 수행</span></span>
<span class="line">        <span class="token keyword">if</span> desired_power <span class="token operator">==</span> <span class="token string">&quot;꺼짐&quot;</span><span class="token punctuation">:</span></span>
<span class="line">            shutdown_device<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="update-콜백-상태-업데이트-결과-확인" tabindex="-1"><a class="header-anchor" href="#update-콜백-상태-업데이트-결과-확인"><span>Update 콜백: 상태 업데이트 결과 확인</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">shadow_callback_update</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> responseStatus<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;Shadow 업데이트 결과 처리&quot;&quot;&quot;</span></span>
<span class="line">    <span class="token keyword">if</span> responseStatus <span class="token operator">==</span> <span class="token string">&quot;accepted&quot;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Shadow 업데이트 성공&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Shadow 업데이트 실패: </span><span class="token interpolation"><span class="token punctuation">{</span>responseStatus<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="실무-팁" tabindex="-1"><a class="header-anchor" href="#실무-팁"><span>실무 팁</span></a></h2><h3 id="연결-안정성-향상" tabindex="-1"><a class="header-anchor" href="#연결-안정성-향상"><span>연결 안정성 향상</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 타임아웃 값을 여유있게 설정</span></span>
<span class="line">shadow_client<span class="token punctuation">.</span>configureConnectDisconnectTimeout<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment"># 기본 10초 → 20초</span></span>
<span class="line">shadow_client<span class="token punctuation">.</span>configureMQTTOperationTimeout<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>      <span class="token comment"># 기본 5초 → 10초</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 자동 재연결 설정</span></span>
<span class="line">shadow_client<span class="token punctuation">.</span>configureAutoReconnectBackoffTime<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="에러-처리" tabindex="-1"><a class="header-anchor" href="#에러-처리"><span>에러 처리</span></a></h3><p>실제 운영에서는 네트워크 문제로 인한 연결 실패가 빈번하다. 반드시 예외 처리를 해주자:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">    shadow_client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;AWS IoT 연결 성공&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;연결 실패: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 재시도 로직 또는 로그 기록</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h1 id="_4-job-대규모-디바이스-관리의-핵심" tabindex="-1"><a class="header-anchor" href="#_4-job-대규모-디바이스-관리의-핵심"><span>4. Job: 대규모 디바이스 관리의 핵심</span></a></h1><h2 id="job이-필요한-이유" tabindex="-1"><a class="header-anchor" href="#job이-필요한-이유"><span>Job이 필요한 이유</span></a></h2><p>Shadow는 상태 관리에 특화되어 있지만, 다음과 같은 상황에서는 한계가 있다:</p><ul><li><strong>펌웨어 업데이트</strong>: 수백 대의 디바이스에 동시에 새 펌웨어 배포</li><li><strong>설정 변경</strong>: 특정 그룹의 디바이스들에게 일괄 설정 변경 명령</li><li><strong>진행 상황 추적</strong>: 작업이 성공했는지, 실패했는지, 어디서 멈췄는지 관리</li></ul><p>이런 <strong>명령 중심의 작업</strong>에는 Job을 사용한다.</p><h2 id="shadow-vs-job-비교" tabindex="-1"><a class="header-anchor" href="#shadow-vs-job-비교"><span>Shadow vs Job 비교</span></a></h2><table><thead><tr><th>구분</th><th>Shadow</th><th>Job</th></tr></thead><tbody><tr><td>목적</td><td>상태 동기화</td><td>명령 실행</td></tr><tr><td>방식</td><td>&quot;이 상태가 되어야 해&quot;</td><td>&quot;이 작업을 해줘&quot;</td></tr><tr><td>대상</td><td>개별 디바이스</td><td>개별 또는 그룹</td></tr><tr><td>예시</td><td>&quot;전원을 켜진 상태로 유지&quot;</td><td>&quot;펌웨어를 v2.0으로 업데이트&quot;</td></tr><tr><td>상태 추적</td><td>desired/reported</td><td>IN_PROGRESS/SUCCEEDED/FAILED</td></tr></tbody></table><h2 id="job-document-구조" tabindex="-1"><a class="header-anchor" href="#job-document-구조"><span>Job Document 구조</span></a></h2><p>Job Document는 자유로운 JSON 형식이다. 실무에서는 다음과 같은 구조를 많이 사용한다:</p><h3 id="예시-1-펌웨어-업데이트" tabindex="-1"><a class="header-anchor" href="#예시-1-펌웨어-업데이트"><span>예시 1: 펌웨어 업데이트</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;operation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;update-firmware&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://my-bucket.s3.amazonaws.com/firmware-v2.0.bin&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;checksum&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:abc123...&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="예시-2-설정-변경" tabindex="-1"><a class="header-anchor" href="#예시-2-설정-변경"><span>예시 2: 설정 변경</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;operation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;update-config&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;logLevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DEBUG&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;reportInterval&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;sensors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;humidity&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="예시-3-단순-명령" tabindex="-1"><a class="header-anchor" href="#예시-3-단순-명령"><span>예시 3: 단순 명령</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;operation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;reboot&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;delay&quot;</span><span class="token operator">:</span> <span class="token number">60</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="job-생성-및-관리" tabindex="-1"><a class="header-anchor" href="#job-생성-및-관리"><span>Job 생성 및 관리</span></a></h2><h3 id="cli로-job-생성" tabindex="-1"><a class="header-anchor" href="#cli로-job-생성"><span>CLI로 Job 생성</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">aws iot create-job <span class="token punctuation">\</span></span>
<span class="line">  --job-id firmware-update-2024 <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--targets</span> <span class="token string">&quot;arn:aws:iot:ap-northeast-2:123456789012:thinggroup/ProductionDevices&quot;</span> <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--document</span> file://firmware-job.json <span class="token punctuation">\</span></span>
<span class="line">  --timeout-config <span class="token assign-left variable">inProgressTimeoutInMinutes</span><span class="token operator">=</span><span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="디바이스에서-job-처리" tabindex="-1"><a class="header-anchor" href="#디바이스에서-job-처리"><span>디바이스에서 Job 처리</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">process_job</span><span class="token punctuation">(</span>job_document<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;Job 문서를 파싱하고 작업 수행&quot;&quot;&quot;</span></span>
<span class="line">    operation <span class="token operator">=</span> job_document<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;operation&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> operation <span class="token operator">==</span> <span class="token string">&quot;update-firmware&quot;</span><span class="token punctuation">:</span></span>
<span class="line">        url <span class="token operator">=</span> job_document<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        version <span class="token operator">=</span> job_document<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;version&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> download_and_install_firmware<span class="token punctuation">(</span>url<span class="token punctuation">,</span> version<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">elif</span> operation <span class="token operator">==</span> <span class="token string">&quot;update-config&quot;</span><span class="token punctuation">:</span></span>
<span class="line">        config <span class="token operator">=</span> job_document<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;config&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> update_device_config<span class="token punctuation">(</span>config<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">elif</span> operation <span class="token operator">==</span> <span class="token string">&quot;reboot&quot;</span><span class="token punctuation">:</span></span>
<span class="line">        delay <span class="token operator">=</span> job_document<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;delay&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> schedule_reboot<span class="token punctuation">(</span>delay<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;FAILED&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reason&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Unknown operation&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h1 id="_5-실무에서-배운-교훈들" tabindex="-1"><a class="header-anchor" href="#_5-실무에서-배운-교훈들"><span>5. 실무에서 배운 교훈들</span></a></h1><h2 id="디바이스-오프라인-대응" tabindex="-1"><a class="header-anchor" href="#디바이스-오프라인-대응"><span>디바이스 오프라인 대응</span></a></h2><p>실제 IoT 환경에서는 디바이스가 예상보다 자주 오프라인이 된다. 특히 모바일 환경이나 Wi-Fi가 불안정한 곳에서는 더욱 그렇다. Shadow의 진가는 이런 상황에서 발휘된다.</p><ul><li><strong>Before Shadow</strong>: 명령이 실패하면 사용자가 다시 시도해야 함</li><li><strong>After Shadow</strong>: 디바이스가 다시 온라인 되면 자동으로 상태 동기화</li></ul><h2 id="대규모-배포시-주의사항" tabindex="-1"><a class="header-anchor" href="#대규모-배포시-주의사항"><span>대규모 배포시 주의사항</span></a></h2><p>수백 대의 디바이스에 동시에 Job을 배포할 때는 반드시 **점진적 배포(Rollout)**를 사용하자:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;jobExecutionsRolloutConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;maximumPerMinute&quot;</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;exponentialRate&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;baseRatePerMinute&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;incrementFactor&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;rateIncreaseCriteria&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;numberOfSucceededThings&quot;</span><span class="token operator">:</span> <span class="token number">10</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>처음에 이걸 안 하고 전체 디바이스에 동시 배포했다가 AWS IoT Core 할당량에 걸려서 곤란했던 경험이 있다.</p><h2 id="보안-관련-팁" tabindex="-1"><a class="header-anchor" href="#보안-관련-팁"><span>보안 관련 팁</span></a></h2><h3 id="_1-인증서-로테이션" tabindex="-1"><a class="header-anchor" href="#_1-인증서-로테이션"><span>1. 인증서 로테이션</span></a></h3><ul><li>프로덕션 환경에서는 주기적으로 인증서를 갱신하자</li><li>AWS IoT Core에서 인증서 만료일 알림 설정 가능</li></ul><h3 id="_2-정책-최소권한-원칙" tabindex="-1"><a class="header-anchor" href="#_2-정책-최소권한-원칙"><span>2. 정책 최소권한 원칙</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;Version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2012-10-17&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;Statement&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;iot:Connect&quot;</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:iot:region:account:client/${iot:Connection.Thing.ThingName}&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">      <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;iot:GetThingShadow&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;iot:UpdateThingShadow&quot;</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:iot:region:account:thing/${iot:Connection.Thing.ThingName}/shadow&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>필요한 권한만 최소한으로 부여하는 것이 중요하다.</p><hr><h1 id="_6-메시지-크기-최적화-비용-절약의-핵심" tabindex="-1"><a class="header-anchor" href="#_6-메시지-크기-최적화-비용-절약의-핵심"><span>6. 메시지 크기 최적화: 비용 절약의 핵심</span></a></h1><h2 id="aws-iot-core-실제-과금-방식" tabindex="-1"><a class="header-anchor" href="#aws-iot-core-실제-과금-방식"><span>AWS IoT Core 실제 과금 방식</span></a></h2><p>처음 AWS IoT Core를 사용할 때 메시지 크기에 대해 잘못 이해하고 있었다. 공식 문서에는 &quot;최대 128KB 메시지 지원&quot;이라고 나와 있지만, 실제 과금은 <strong>5KB 단위</strong>로 이루어진다.</p><h3 id="실제-과금-구조" tabindex="-1"><a class="header-anchor" href="#실제-과금-구조"><span>실제 과금 구조</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">- 0~5KB: 1 메시지 요금</span>
<span class="line">- 5KB~10KB: 2 메시지 요금  </span>
<span class="line">- 10KB~15KB: 3 메시지 요금</span>
<span class="line">- ...</span>
<span class="line">- 125KB~128KB: 26 메시지 요금 (최대)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>이때문에 5.1KB 메시지 하나는 4.9KB 메시지보다 <strong>2배</strong>의 비용이 든다.</p><h2 id="실제-비용-영향-사례" tabindex="-1"><a class="header-anchor" href="#실제-비용-영향-사례"><span>실제 비용 영향 사례</span></a></h2><p>아례는 예시이다.</p><h3 id="before-최적화-8kb-센서-데이터" tabindex="-1"><a class="header-anchor" href="#before-최적화-8kb-센서-데이터"><span>Before 최적화 (8KB 센서 데이터)</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 최적화 전: 8KB 메시지</span></span>
<span class="line">message <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;deviceIdentifier&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sensor-temperature-basement-001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;measurementTimestamp&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2025-06-27T10:30:00.000Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;temperatureReadings&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">23.1</span><span class="token punctuation">,</span> <span class="token number">23.2</span><span class="token punctuation">,</span> <span class="token number">23.1</span><span class="token punctuation">,</span> <span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token number">23.2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 1000개 데이터</span></span>
<span class="line">    <span class="token string">&quot;humidityReadings&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">65.2</span><span class="token punctuation">,</span> <span class="token number">65.1</span><span class="token punctuation">,</span> <span class="token number">65.3</span><span class="token punctuation">,</span> <span class="token number">65.0</span><span class="token punctuation">,</span> <span class="token number">65.4</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment"># 1000개 데이터</span></span>
<span class="line">    <span class="token string">&quot;deviceMetadata&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;firmwareVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v2.1.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;batteryLevel&quot;</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;signalStrength&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">45</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment"># 크기: 8KB → 2 메시지 요금 부과</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="after-최적화-4-2kb-압축-데이터" tabindex="-1"><a class="header-anchor" href="#after-최적화-4-2kb-압축-데이터"><span>After 최적화 (4.2KB 압축 데이터)</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 최적화 후: 4.2KB 메시지</span></span>
<span class="line">message <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;st_b001&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># deviceIdentifier 축약</span></span>
<span class="line">    <span class="token string">&quot;ts&quot;</span><span class="token punctuation">:</span> <span class="token number">1719485400</span><span class="token punctuation">,</span>  <span class="token comment"># unix timestamp 사용</span></span>
<span class="line">    <span class="token string">&quot;temp&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;23.1,23.2,23.1,23.0,23.2,...&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 배열을 문자열로 압축</span></span>
<span class="line">    <span class="token string">&quot;hum&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;65.2,65.1,65.3,65.0,65.4,...&quot;</span><span class="token punctuation">,</span>   <span class="token comment"># 배열을 문자열로 압축</span></span>
<span class="line">    <span class="token string">&quot;meta&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;fw&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v2.1.0&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 키 이름 축약</span></span>
<span class="line">        <span class="token string">&quot;bat&quot;</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;sig&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">45</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment"># 크기: 4.2KB → 1 메시지 요금만 부과</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>결과: 메시지당 비용이 50% 절약!</strong></p><h2 id="월별-비용-차이-계산" tabindex="-1"><a class="header-anchor" href="#월별-비용-차이-계산"><span>월별 비용 차이 계산</span></a></h2><p>월 100만 메시지를 전송하는 디바이스 100대 기준,</p><h3 id="_8kb-메시지-최적화-전" tabindex="-1"><a class="header-anchor" href="#_8kb-메시지-최적화-전"><span>8KB 메시지 (최적화 전)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">- 월 메시지: 100만 × 100대 = 1억 메시지</span>
<span class="line">- 과금 메시지: 2억 메시지 (5KB 초과로 2배 계산)</span>
<span class="line">- 월 비용: 2억 × $1.20/1백만 = $240</span>
<span class="line">- 연간 비용: $240 × 12 = $2,880</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2kb-메시지-최적화-후" tabindex="-1"><a class="header-anchor" href="#_4-2kb-메시지-최적화-후"><span>4.2KB 메시지 (최적화 후)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">- 월 메시지: 100만 × 100대 = 1억 메시지  </span>
<span class="line">- 과금 메시지: 1억 메시지 (5KB 이하로 1배 계산)</span>
<span class="line">- 월 비용: 1억 × $1.20/1백만 = $120</span>
<span class="line">- 연간 비용: $120 × 12 = $1,440</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>연간 절약액: $1,440 (50% 절약)</strong></p><h2 id="실무-최적화-기법들" tabindex="-1"><a class="header-anchor" href="#실무-최적화-기법들"><span>실무 최적화 기법들</span></a></h2><h3 id="_1-json-키-이름-축약" tabindex="-1"><a class="header-anchor" href="#_1-json-키-이름-축약"><span>1. JSON 키 이름 축약</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Before: 장황한 키 이름 (가독성 좋지만 비효율)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;deviceIdentifier&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sensor-001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;measurementTimestamp&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2025-06-27T10:30:00Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;temperatureReading&quot;</span><span class="token punctuation">:</span> <span class="token number">23.45</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;humidityPercentage&quot;</span><span class="token punctuation">:</span> <span class="token number">65.2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;batteryVoltageLevel&quot;</span><span class="token punctuation">:</span> <span class="token number">3.7</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># After: 축약된 키 이름 (크기 약 40% 절약)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;s001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;ts&quot;</span><span class="token punctuation">:</span> <span class="token number">1719485400</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;temp&quot;</span><span class="token punctuation">:</span> <span class="token number">23.45</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;hum&quot;</span><span class="token punctuation">:</span> <span class="token number">65.2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;bat&quot;</span><span class="token punctuation">:</span> <span class="token number">3.7</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-데이터-타입-최적화" tabindex="-1"><a class="header-anchor" href="#_2-데이터-타입-최적화"><span>2. 데이터 타입 최적화</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Before: 문자열 타임스탬프 (29 bytes)</span></span>
<span class="line"><span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2025-06-27T10:30:00.000Z&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># After: Unix 타임스탬프 (10 bytes)</span></span>
<span class="line"><span class="token string">&quot;ts&quot;</span><span class="token punctuation">:</span> <span class="token number">1719485400</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-배열-데이터-압축" tabindex="-1"><a class="header-anchor" href="#_3-배열-데이터-압축"><span>3. 배열 데이터 압축</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Before: JSON 배열 (크기 큼)</span></span>
<span class="line"><span class="token string">&quot;readings&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">23.1</span><span class="token punctuation">,</span> <span class="token number">23.2</span><span class="token punctuation">,</span> <span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token number">23.1</span><span class="token punctuation">,</span> <span class="token number">23.2</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># After: 문자열 압축 (크기 작음)</span></span>
<span class="line"><span class="token string">&quot;readings&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;23.1,23.2,23.0,23.1,23.2&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-gzip-압축-활용" tabindex="-1"><a class="header-anchor" href="#_4-gzip-압축-활용"><span>4. GZIP 압축 활용</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">import</span> gzip</span>
<span class="line"><span class="token keyword">import</span> base64</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">compress_message</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;메시지를 GZIP으로 압축&quot;&quot;&quot;</span></span>
<span class="line">    json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">    compressed <span class="token operator">=</span> gzip<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>json_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    encoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>compressed<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;compressed&quot;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> encoded</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 실제 측정 결과:</span></span>
<span class="line"><span class="token comment"># Original: 8192 bytes (8KB)</span></span>
<span class="line"><span class="token comment"># Compressed: 2048 bytes (2KB) → 75% 절약!</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="메시지-크기-모니터링-도구" tabindex="-1"><a class="header-anchor" href="#메시지-크기-모니터링-도구"><span>메시지 크기 모니터링 도구</span></a></h2><p>실무에서 사용하는 메시지 크기 체크 함수</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> json</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">check_message_size</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> warn_threshold<span class="token operator">=</span><span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;메시지 크기를 체크하고 경고&quot;&quot;&quot;</span></span>
<span class="line">    json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>message<span class="token punctuation">)</span></span>
<span class="line">    size_kb <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>json_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> size_kb <span class="token operator">&gt;</span> <span class="token number">5.0</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;🚨 CRITICAL: </span><span class="token interpolation"><span class="token punctuation">{</span>size_kb<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">KB - 2배 요금 부과!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">False</span></span>
<span class="line">    <span class="token keyword">elif</span> size_kb <span class="token operator">&gt;</span> warn_threshold<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;⚠️ WARNING: </span><span class="token interpolation"><span class="token punctuation">{</span>size_kb<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">KB - 최적화 권장&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">True</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;✅ GOOD: </span><span class="token interpolation"><span class="token punctuation">{</span>size_kb<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">KB - 최적화됨&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">True</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 사용 예시</span></span>
<span class="line">message <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sensor001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token keyword">not</span> check_message_size<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    message <span class="token operator">=</span> optimize_message<span class="token punctuation">(</span>message<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="배치-전송으로-효율성-극대화" tabindex="-1"><a class="header-anchor" href="#배치-전송으로-효율성-극대화"><span>배치 전송으로 효율성 극대화</span></a></h2><p>개별 메시지 대신 배치로 전송하면 더욱 효율적이다.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">batch_messages</span><span class="token punctuation">(</span>sensor_readings<span class="token punctuation">,</span> max_size_kb<span class="token operator">=</span><span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;메시지들을 4.5KB 이하 배치로 묶어서 전송&quot;&quot;&quot;</span></span>
<span class="line">    batch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    current_size <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> reading <span class="token keyword">in</span> sensor_readings<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 메시지 크기 계산</span></span>
<span class="line">        test_batch <span class="token operator">=</span> batch <span class="token operator">+</span> <span class="token punctuation">[</span>reading<span class="token punctuation">]</span></span>
<span class="line">        test_size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>test_batch<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">if</span> test_size <span class="token operator">&gt;</span> max_size_kb <span class="token keyword">and</span> batch<span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 현재 배치 전송</span></span>
<span class="line">            publish_message<span class="token punctuation">(</span>batch<span class="token punctuation">)</span></span>
<span class="line">            batch <span class="token operator">=</span> <span class="token punctuation">[</span>reading<span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            batch<span class="token punctuation">.</span>append<span class="token punctuation">(</span>reading<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 마지막 배치 전송</span></span>
<span class="line">    <span class="token keyword">if</span> batch<span class="token punctuation">:</span></span>
<span class="line">        publish_message<span class="token punctuation">(</span>batch<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Before: 100개 메시지 개별 전송 (1KB씩) = 100 메시지 요금</span></span>
<span class="line"><span class="token comment"># After: 4개 배치로 묶어서 전송 (4KB씩) = 25 메시지 요금 (75% 절약!)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="다른-aws-iot-서비스들도-마찬가지" tabindex="-1"><a class="header-anchor" href="#다른-aws-iot-서비스들도-마찬가지"><span>다른 AWS IoT 서비스들도 마찬가지</span></a></h2><p>이 5KB 규칙은 다른 AWS IoT 서비스에도 적용된다.</p><h3 id="device-shadow" tabindex="-1"><a class="header-anchor" href="#device-shadow"><span>Device Shadow</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Shadow 업데이트도 5KB 초과시 2배 요금</span></span>
<span class="line">shadow_update <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;state&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;desired&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;config&quot;</span><span class="token punctuation">:</span> very_large_config_data  <span class="token comment"># 5KB 초과 주의!</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rules-engine" tabindex="-1"><a class="header-anchor" href="#rules-engine"><span>Rules Engine</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Rule이 처리하는 메시지도 5KB 기준으로 계산</span></span>
<span class="line"><span class="token comment"># 8KB 메시지 → 2개 Rule 실행 요금 부과</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="핵심-권장사항" tabindex="-1"><a class="header-anchor" href="#핵심-권장사항"><span>핵심 권장사항</span></a></h2><ol><li><strong>4.8KB 이하 목표</strong>: 여유분을 고려해 4.8KB 이하로 메시지 크기 설정</li><li><strong>실시간 모니터링</strong>: 프로덕션에서 메시지 크기 모니터링 도구 사용</li><li><strong>압축 활용</strong>: GZIP, 키 축약, 타입 최적화 등 적극 활용</li><li><strong>배치 전송</strong>: 가능한 경우 여러 데이터를 배치로 묶어서 전송</li><li><strong>정기적 리뷰</strong>: 메시지 구조를 정기적으로 리뷰하고 최적화</li></ol><p>이런 최적화를 통해 우리 프로젝트에서는 연간 IoT 통신 비용을 약 60% 절약할 수 있었다. 특히 대규모 IoT 배포에서는 이런 작은 최적화가 큰 비용 절약으로 이어진다는 점을 꼭 기억하자.</p><nav class="vp-page-nav" aria-label="page navigation" data-v-63cabaa2><!----><!----></nav></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-e4ePmsVK.js" defer></script>
  </body>
</html>
